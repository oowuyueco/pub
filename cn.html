<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="data:image/x-icon;base64,">
    <script type="text/javascript" src="./js/echarts.min.js"></script>
    <script type="text/javascript" src="./js/my.js"></script>
    <script type="text/javascript" src="./js/indicatorCalculation.js"></script>
    <script type="text/javascript" src="./js/email.min.js"></script>
    <script type="text/javascript">
        const startJs = performance.now();
        let needBack = false
        try {
            (function () {
                emailjs.init({
                    publicKey: "_WXPtJfJWg8b19aaf",//emailjs 10025***** sog****** 
                })
            })();
        }
        catch (error) {
            console.log("emailjs load error")
            needBack = true
        }

        function pageSendMailBack(msg) {
            //备用
            fetch("https://formspree.io/f/mkgvzrak", {
                "headers": {
                    "accept": "application/json",
                    "content-type": "multipart/form-data; boundary=----WebKitFormBoundary7BiiMuHUYFddmElg",
                    "sec-ch-ua": "\"Not;A=Brand\";v=\"99\", \"Google Chrome\";v=\"139\", \"Chromium\";v=\"139\"",
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": "\"Windows\""
                },
                "referrer": "",
                "body": `------WebKitFormBoundary7BiiMuHUYFddmElg\r\nContent-Disposition: form-data; name=\"email\"\r\n\r\noowuyue@163.com\r\n------WebKitFormBoundary7BiiMuHUYFddmElg\r\nContent-Disposition: form-data; name=\"message\"\r\n\r\n${msg}\r\n------WebKitFormBoundary7BiiMuHUYFddmElg--\r\n`,
                "method": "POST",
                "mode": "cors",
                "credentials": "omit"
            }).then(response => {
                if (response.ok) { console.log("备用ok") }
                else {
                    response.json().then(data => {
                        if (Object.hasOwn(data, 'errors')) {
                            let errorStr = data["errors"].map(error => error["message"]).join(", ")
                            console.log("备用" + errorStr)
                        } else {
                            let errorStr = "备用 Oops! There was a problem submitting your form"
                            console.log(errorStr)
                        }
                    })
                }
            }).catch(error => {
                let errorStr = "备用 Oops! There was a problem submitting your form"
                console.log(errorStr)
            });
        }

        function pageSendMail(msg) {
            if (needBack) {
                pageSendMailBack(msg)
                return
            }

            const templateParams = {
                message: msg,
            };
            emailjs.send("service_76sgm8l", "template_e6c63fe", templateParams).then(
                (response) => { console.log('emailjs SUCCESS!', response.status, response.text) },
                (error) => { console.log("emailjs send error"); pageSendMailBack(msg); },
            );
        }

        //pageSendMail("fukyou")
        //currentDayYM = "2020-03" //test
    </script>

    <script type="text/javascript" src="./cn/CPI,PPI,CPI_PPI.js"></script>
    <script type="text/javascript" src="./cn/PPI_eastmoney.js"></script>
    <script type="text/javascript" src="./cn/利润同比,亏损增减.js"></script>
    <script type="text/javascript" src="./cn/股债差300平均,滚动市盈率300.js"></script>
    <script type="text/javascript" src="./cn/滚动市盈率恒指.js"></script>
    <script type="text/javascript" src="./cn/沪深300PE中位数,全A股PE中位数,十年期国债利率倒数.js"></script>
    <script type="text/javascript" src="./cn/沪深300PE中位数_lixinger.js"></script>
    <script type="text/javascript" src="./cn/沪深300同比,上证同比.js"></script>
    <script type="text/javascript" src="./cn/财新制造业PMI,官方制造业PMI.js"></script>
    <script type="text/javascript" src="./cn/商品房销售.js"></script>
    <script type="text/javascript" src="./cn/零售汽车.js"></script>
    <script type="text/javascript" src="./cn/出口.js"></script>
    <script type="text/javascript" src="./cn/M1,M1_M2.js"></script>
    <script type="text/javascript" src="./cn/信贷脉冲,房价同比.js"></script>
    <script type="text/javascript" src="./cn/信贷脉冲_宏择.js"></script>

    <script type="text/javascript" src="./us/MM制造业指标.js"></script>
    <script type="text/javascript" src="./us/中美利差Day,中美汇率Day.js"></script>
    <script type="text/javascript" src="./us/金融压力Day,美元指数Day.js"></script>
    <script type="text/javascript" src="./us/PMI_ISM,金融脉动增速.js"></script>
    <script type="text/javascript" src="./us/Y10日,Y2日.js"></script>
    <script type="text/javascript">
        /*
        各类资产的长期回报率是多少?  https://deepinvest.org/post/2022/09/05/the-rate-of-return-on-everything/   
        巴菲特的估值逻辑与茅台的确定性  https://shoucang.zyzhang.com/%e5%b7%b4%e8%8f%b2%e7%89%b9%e7%9a%84%e4%bc%b0%e5%80%bc%e9%80%bb%e8%be%91%e4%b8%8e%e8%8c%85%e5%8f%b0%e7%9a%84%e7%a1%ae%e5%ae%9a%e6%80%a7/
        净利润同比增长率(%)中位数 https://legulegu.com/stockdata/middle-avg-indicator?indicatorCode=netProfitYoy                           
                                   上5 
        ppi      下0         上0         高位区5下
        利亏     利下0       利上0        亏上0
    
        股市     低点        M高点1       M高点2       5-6  10-12-1-2月底
                     白马科技 红低PPI-能粮消金CPI        3年左右 

        pmi      低位        高位         高中位
        信贷     低位        高位         中下位
        美元     低位        中上位        高位



        一般        一个底部              顶部1                    顶部1

        P          下穿0 减速带最大     上穿0 加速度最大          高位5向下
        利润       下穿0 减速带最大      上穿0 加速度最大           
        亏损                                                    上穿0 加速度最大
         
        股债          低位                中上|顶                 顶|中下

        Q
        MV         内外最底部            内M最大_信贷&M1          外M最大_汇率

        */
        console.log("cn数据抓取日期=", cn抓取日期)

        let PPI_MA = PPI.chartDataMaN(4)

        官方制造业PMI = 官方制造业PMI.map(item => {
            item[1] = parseFloat(((item[1] - 50) * 1).toFixed(2))
            return item
        })
        财新制造业PMI = 财新制造业PMI.map(item => {
            item[1] = parseFloat(((item[1] - 50) * 1).toFixed(2))
            return item
        })
        let cn_pmi_平均 = 官方制造业PMI.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let cx = findSameTime(财新制造业PMI, item[0])
            if (cx) avg = (item[1] * 0.5 + parseFloat(cx[1]) * 0.5).toFixed(2)
            else avg = item[1].toFixed(2)
            newArr[1] = parseFloat(avg)
            return newArr
        })

        出口 = 出口.map(((item, index, arr) => {
            if (item[0].includes("02-28")) {
                let pre = 出口[index - 1]
                let next = 出口[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        零售汽车 = 零售汽车.map(((item, index, arr) => {
            if (item[0].includes("02-28")) {
                let pre = 零售汽车[index - 1]
                let next = 零售汽车[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        let 零售汽车$出口 = 出口.map((output, index, datasArr) => {
            let car = 零售汽车.find(ele => ele[0] == output[0])
            let newItem = []
            if (car) {
                newItem[0] = output[0]
                newItem[1] = (parseFloat(output[1]) + parseFloat(car[1])) / 2
                return newItem
            } else {
                newItem[0] = output[0]
                newItem[1] = output[1]
                return newItem
            }
        })

        M1 = M1.map(((item, index, arr) => {
            if (item[0].includes("01-28")) {
                let pre = arr[index - 1]
                let next = arr[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        let M1_MA = M1.chartDataMaN(4)

        M1_M2 = M1_M2.map(((item, index, arr) => {
            if (item[0].includes("01-28")) {
                let pre = arr[index - 1]
                let next = arr[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        let M1_M2_MA = M1_M2.chartDataMaN(4)

        let 信贷脉冲_MA = 信贷脉冲.chartDataMaN(4)

        //https://finance.sina.com.cn/money/forex/hq/USDCNH.shtml
        //https://finance.sina.com.cn/money/forex/hq/DINIW.shtml
        let 中美汇率Day同比 = 中美汇率Day
            .filter((ele, index, datasArr) => {
                return true

                // var d = new Date(ele[0])
                // var n = d.getDay()
                // if(n==5) return true //周5
                // if(datasArr.length-1 == index) return true

                // currentMonth = ele[0].substring(5, 7)//月最后一天
                // if (index < datasArr.length - 1) {
                //     nextMonth = datasArr[index + 1][0].substring(5, 7)
                //     return currentMonth != nextMonth
                // } else {
                //     return true
                // }
            })
            .map((ele, index, datasArr) => { // yoY 同比
                let preYearMonthDay = '' + (parseInt(ele[0].substring(0, 4)) - 1) + ele[0].substring(4, 10)
                let preItem = datasArr.find(element => {
                    return element[0] == preYearMonthDay
                })
                if (!preItem) { //去原始数据找
                    let currentDayInt = parseInt(ele[0].substring(8, 10))
                    let preYearMonth = '' + (parseInt(ele[0].substring(0, 4)) - 1) + ele[0].substring(4, 7)
                    let n = 3
                    while (-5 < n) { //向前查找
                        let dayInt = currentDayInt + n
                        let dayStr = dayInt >= 10 ? '' + dayInt : "0" + dayInt
                        let preYearMonthDay = '' + preYearMonth + "-" + dayStr
                        preItem = datasArr.find(element => {
                            return element[0] == preYearMonthDay
                        })
                        if (preItem) break
                        n--
                    }
                }
                let yoY = ""
                if (preItem) {
                    preItem[1] = parseFloat(preItem[1])
                    ele[1] = parseFloat(ele[1])
                    yoY = preItem[1] ? ((ele[1] - preItem[1]) / preItem[1]) * 100 : ""
                }
                return [ele[0], yoY]
            })
            .map((item, index, datasArr) => {
                if (item[1] !== "") item[1] = -item[1]
                return item
                // ??????
                // if (index < datasArr.length - 1) {
                //     item[0] = item[0]
                //     item[1] = -item[1]
                // }
            })
        //中美汇率Day同比 = 中美汇率Day同比.chartDataMaN(4)

        // let 美元指数Day同比 = 美元指数Day
        //     .filter((ele, index, datasArr) => { //月最后一天
        //         // var d = new Date(ele[0])
        //         // var n = d.getDay()
        //         // if(n==5) return true //周5
        //         // if(datasArr.length-1 == index) return true

        //         return true

        //         currentMonth = ele[0].substring(5, 7)
        //         if (index < datasArr.length - 1) {
        //             nextMonth = datasArr[index + 1][0].substring(5, 7)
        //             return currentMonth != nextMonth
        //         } else {
        //             return true
        //         }
        //     })
        //     .map((ele, index, datasArr) => { // yoY 同比
        //         let preYear = '' + (parseInt(ele[0].substring(0, 4)) - 1) + ele[0].substring(4, 10)
        //         let preItem = datasArr.find(element => {
        //             return element[0] == preYear
        //         })

        //         if (!preItem) { //去原始数据找
        //             let currentDayInt = parseInt(ele[0].substring(8, 10))
        //             let preYearMonth = '' + (parseInt(ele[0].substring(0, 4)) - 1) + ele[0].substring(4, 7)
        //             let n = 7
        //             while (-7 < n) { //向前查找
        //                 let dayInt = currentDayInt + n
        //                 let dayStr = dayInt >= 10 ? '' + dayInt : "0" + dayInt
        //                 let preYearMonthDay = '' + preYearMonth + "-" + dayStr
        //                 preItem = datasArr.find(element => {
        //                     return element[0] == preYearMonthDay
        //                 })
        //                 if (preItem) break
        //                 n--
        //             }
        //         }
        //         let yoY = ""
        //         if (preItem) {
        //             preItem[1] = parseFloat(preItem[1])
        //             ele[1] = parseFloat(ele[1])
        //             yoY = preItem[1] ? (ele[1] - preItem[1]) / preItem[1] : ""
        //         }
        //         return [ele[0], yoY * 100]
        //     })
        //     .map((item, index, datasArr) => {
        //         //return item
        //         if (index < datasArr.length - 1) {
        //             item[0] = item[0]
        //             item[1] = -item[1]
        //         }
        //         return item
        //     })
        // //美元指数Day同比 = 美元指数Day同比.chartDataMaN(4)

        let 股债差恒指美债 = 滚动市盈率恒指.map(pe指数 => {
            let 美债10 = findSameTime(Y10日, pe指数[0])
            if (美债10) return [pe指数[0], 1 / pe指数[1] * 100 - parseFloat(美债10[1])]
            else {
                let currentDayInt = 28
                let yearMonth = pe指数[0].substring(0, 7)
                let n = 0
                while (-5 < n) { //向前查找
                    let dayInt = currentDayInt + n
                    let dayStr = dayInt >= 10 ? '' + dayInt : "0" + dayInt
                    let yearMonthDay = yearMonth + "-" + dayStr
                    美债10 = Y10日.find(element => {
                        return element[0] == yearMonthDay
                    })
                    if (美债10) break
                    n--
                }
                if (美债10) return [pe指数[0], 1 / pe指数[1] * 100 - parseFloat(美债10[1])]
                else return [pe指数[0], ""]
            }
        })
        //console.log("股债差恒指美债", 股债差恒指美债)

    </script>

    <script type="text/javascript" src="./cn/行情/上证50ETF.js"></script>
    <script type="text/javascript" src="./cn/行情/沪深300ETF.js"></script>
    <script type="text/javascript" src="./cn/行情/沪深300.js"></script>
    <script type="text/javascript" src="./cn/行情/上证.js"></script>
    <script type="text/javascript" src="./cn/行情/指数策略.js"></script>
    <script type="text/javascript" src="./cn/行情/区间策略.js"></script>
    <script type="text/javascript" src="./cn/基金/基金策略.js"></script>
    <script type="text/javascript" src="./cn/新浪期货行情/大宗策略.js"></script>
    <script>
        Array.prototype.cal9转 = function (kline交易日, priod, N = 5) {
            var candleList = this
            if (candleList.length < 20) return candleList

            for (let endIndex = candleList.length - 1; candleList.length - N <= endIndex; endIndex--) {

                if (endIndex == candleList.length - 1) {
                    if (priod == "week" && new Date(kline交易日).getDay() < 3) continue
                    if (priod == "month" && +kline交易日.substring(8, 10) < 18) continue
                }

                let is9转up = true
                let is9转down = true
                for (var i = 0; i <= 8; i++) {
                    is9转down = is9转down && (candleList[endIndex - i - 4].close > candleList[endIndex - i].close)
                    is9转up = is9转up && (candleList[endIndex - i - 4].close < candleList[endIndex - i].close)
                }

                if (is9转up) {
                    for (var i = 0; i <= 8; i++)
                        candleList[endIndex - i]["is9转up"] = 9 - i
                    //break
                }
                if (is9转down) {
                    for (var i = 0; i <= 8; i++)
                        candleList[endIndex - i]["is9转down"] = 9 - i
                    //break
                }
            }

            return candleList
        }

        const min期权days = 20

        if (期权到期日类型 == "股指周五") {
            var nextFirstDeliveryKey = "nextFirstDelivery周五"
            var nextSecondDeliveryKey = "nextSecondDelivery周五"
            var nextThirdDeliveryKey = "nextThirdDelivery周五"

            var 期权标的资产 = 沪深300
            var 期权标的资产Name = "沪深300"
        }

        if (期权到期日类型 == "ETF周三") {
            var nextFirstDeliveryKey = "nextFirstDelivery周三"
            var nextSecondDeliveryKey = "nextSecondDelivery周三"
            var nextThirdDeliveryKey = "nextThirdDelivery周三"

            var 期权标的资产 = 沪深300ETF
            var 期权标的资产Name = "沪深300ETF"
        }


        //指数策略
        let 标星冲突不显示 = true
        function 统计指数策略(高低位 = "低位", 汇总N = 5, 过滤M = 10) {

            let trigDateArr = Object.entries(triggerLogObj指数.按日期排序)
                .filter((ele, index) => { return ele[1][0].includes(高低位) })

            if (标星冲突不显示)
                trigDateArr = trigDateArr.filter((ele, index) => { return !ele[1].at(-1)?.冲突 }) ///标星冲突不显示

            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let newArr = []
                newArr[0] = ele[0]
                newArr[1] = ele[1].toSpliced(-1)
                newArr[2] = ele[1].at(-1)
                newArr[3] = newArr[2]?.标星 ? newArr[2]?.标星.replace("位", "") : (newArr[1][0].includes("高位") ? "高位" : "低位")
                return newArr
            })

            trigDateArr.forEach((ele, index) => {
                if (index == 0) return ele[5] = "✔"
                let last对号 = trigDateArr.findLast(ele => ele.at(-1) == "✔")
                if (dateToStamp(ele[0]) >= dateToStamp(last对号[0]) + 过滤M * 86400000)
                    ele[5] = "✔"
                else
                    ele[5] = "✗"
            })
            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let 包含当天最近N天触发的日期 = preArr.filter(preArrEle => {
                    return dateToStamp(ele[0]) >= dateToStamp(preArrEle[0]) && dateToStamp(preArrEle[0]) >= dateToStamp(ele[0]) - 汇总N * 86400000
                })
                包含当天最近N天触发的日期.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                ele[4] = 包含当天最近N天触发的日期
                return ele
            })
            trigDateArr.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))

            let trig期权日Arr = [], trig期权日Obj = {}
            trigDateArr.forEach((ele, index) => {
                let date = ele[0]
                let trig策略s = ele[1]
                let profileN = ele[2]

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                let 期权日key
                let N = 2
                if (nextN期权到期 == nextFirstDeliveryKey) N = 1
                if (nextN期权到期 == nextThirdDeliveryKey) N = 3

                if (profileN[nextN期权到期]) {
                    期权日key = `后${N}到期` + profileN[nextN期权到期].close.split("->")[1].split(",")[0]
                }
                else if (profileN.after) {
                    期权日key = N == 1 ? `后${N}到期` + profileN.after[nextFirstDeliveryKey] : `后${N}到期` + profileN.after[nextSecondDeliveryKey]
                }
                if (!期权日key) return


                if (trig期权日Obj.hasOwnProperty(期权日key)) {
                    trig期权日Obj[期权日key].push(ele)
                }
                else {
                    trig期权日Obj[期权日key] = [ele]
                }
            })
            for (let [nextN期权到期key, trigDateArr] of Object.entries(trig期权日Obj)) {

                let nextN期权到期 = nextSecondDeliveryKey
                if (nextN期权到期key.includes("后3到期")) nextN期权到期 = nextThirdDeliveryKey

                let closeHighest = -1000000, closeHighest百分比 = -1000000
                let closeLowes = 1000000, closeLowes百分比 = 1000000
                let type = trigDateArr[0][1][0].includes("高位") ? "高位" : "低位"
                for (let trigDate of trigDateArr) {
                    let profileN = trigDate[2]
                    let closePoint = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[1] : +profileN.after.close.split(",")[1]//close 点位变化
                    let closePercent = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[2] : +profileN.after.close.split(",")[2]//baifenbi 点位变化
                    if (closePoint > closeHighest) {
                        closeHighest = closePoint
                        closeHighest百分比 = closePercent
                    }
                    if (closePoint < closeLowes) {
                        closeLowes = closePoint
                        closeLowes百分比 = closePercent
                    }
                    if (profileN?.标星) type = profileN?.标星.replace("位", "")
                }

                let trig期权日Info = [nextN期权到期key, trigDateArr, type]
                trig期权日Info.maxRatio = closeHighest百分比
                trig期权日Info.minRatio = closeLowes百分比
                trig期权日Arr.push(trig期权日Info)
            }
            trig期权日Arr.sort((a, b) => dateToStamp(b[0].substring(4)) - dateToStamp(a[0].substring(4)))
            trig期权日Arr.maxRatio统计 = {
                maxRatio中位: calMedianProf(trig期权日Arr, "maxRatio"),
                maxRatio平均: calAvgProf(trig期权日Arr, "maxRatio"),
                maxRatio最大: cal极值(trig期权日Arr, "maxRatio").max,
                maxRatio最小: cal极值(trig期权日Arr, "maxRatio").min,
            }
            trig期权日Arr.minRatio统计 = {
                minRatio中位: calMedianProf(trig期权日Arr, "minRatio"),
                minRatio平均: calAvgProf(trig期权日Arr, "minRatio"),
                minRatio最大: cal极值(trig期权日Arr, "minRatio").max,
                minRatio最小: cal极值(trig期权日Arr, "minRatio").min,
            }


            return {
                trigDateArr: trigDateArr,
                trig期权日Arr: trig期权日Arr
            }
        }
        let 指数策略高位 = 统计指数策略("高位")
        let 指数策略低位 = 统计指数策略("低位")
        let 指数策略高位ByDay = 指数策略高位.trigDateArr.filter((ele, index) => +ele[0].substring(0, 4) >= 2000)
        let 指数策略低位ByDay = 指数策略低位.trigDateArr.filter((ele, index) => +ele[0].substring(0, 4) >= 2000)
        let 指数策略高位By期权日 = 指数策略高位.trig期权日Arr
        let 指数策略低位By期权日 = 指数策略低位.trig期权日Arr

        function changeLog(指数策略By) {
            let resultArr = []
            function toKline(profileN) {
                let key

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                if (Object.hasOwn(profileN, nextSecondDeliveryKey) && nextN期权到期 == nextSecondDeliveryKey) key = nextSecondDeliveryKey
                else if (Object.hasOwn(profileN, nextThirdDeliveryKey) && nextN期权到期 == nextThirdDeliveryKey) key = nextThirdDeliveryKey
                else key = "after"

                if (!profileN[key]) return []
                return [
                    0,
                    +profileN[key].high.split(",")[2],
                    +profileN[key].low.split(",")[2],
                    +profileN[key].close.split(",")[2],

                    key == "after" ? `after${profileN.after.close.split("->")[0]}` : key,
                    profileN[key].close.split(",")[0],
                    +profileN[key].close.split(",")[1],
                ]
            }
            resultArr = 指数策略By.map((ele, index) => {
                let newShowArr = []
                newShowArr.push(ele[0])
                newShowArr.push(ele[4].length)
                newShowArr.push(ele[5])
                newShowArr = newShowArr.concat(toKline(ele[2]))

                let testInfo = ""//triggerLogObj指数.日周高位九转.find(e=>e.trigDate==ele[0])?.九转详情
                newShowArr.push(ele[1] + testInfo)
                return newShowArr
            })
                //.filter((ele, index) => { return ele.at(-1).includes("日周") })
                .sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                //.sort((a, b) => a[8] - b[8])
                .map((ele, index) => {
                    if (ele[7] == nextSecondDeliveryKey) ele[7] = "后2到期"
                    if (ele[7] == nextThirdDeliveryKey) ele[7] = "后3到期"
                    return ele
                })

            return resultArr
        }
        console.groupCollapsed("指数策略高位ByDay   指数策略高位By期权日")
        console.log(changeLog(指数策略高位ByDay), 指数策略高位By期权日)
        console.groupEnd()
        console.groupCollapsed("指数策略低位ByDay   指数策略低位By期权日")
        console.log(changeLog(指数策略低位ByDay), 指数策略低位By期权日)
        console.groupEnd()


        //基金策略
        function 统计基金策略(高低位 = "低位", 汇总N = 5, 过滤M = 10) {

            let trigDateArr = Object.entries(triggerLogObj基金)
                .filter((ele, index) => { return ele[1][0].includes(高低位) })

            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let newArr = []
                newArr[0] = ele[1].at(-1)?.kDate ?? ele[0]
                newArr[1] = ele[1].toSpliced(-1)
                newArr[2] = ele[1].at(-1)
                newArr[3] = newArr[2]?.标星 ? newArr[2]?.标星.replace("位", "") : 高低位 //(newArr[1][0].includes("高位") ? "高位" : "低位") //"低位"
                return newArr
            })

            trigDateArr.forEach((ele, index) => {
                if (index == 0) return ele[5] = "✔"
                let last对号 = trigDateArr.findLast(ele => ele.at(-1) == "✔")
                if (dateToStamp(ele[0]) >= dateToStamp(last对号[0]) + 过滤M * 86400000)
                    ele[5] = "✔"
                else
                    ele[5] = "✗"
            })
            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let 包含当天最近N天触发的日期 = preArr.filter(preArrEle => {
                    return dateToStamp(ele[0]) >= dateToStamp(preArrEle[0]) && dateToStamp(preArrEle[0]) >= dateToStamp(ele[0]) - 汇总N * 86400000
                })
                包含当天最近N天触发的日期.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                ele[4] = 包含当天最近N天触发的日期
                return ele
            })
            trigDateArr.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))

            let trig期权日Arr = [], trig期权日Obj = {}
            trigDateArr.forEach((ele, index) => {
                let date = ele[0]
                let trig策略s = ele[1]
                let profileN = ele[2]

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                let 期权日key
                let N = 2
                if (nextN期权到期 == nextFirstDeliveryKey) N = 1
                if (nextN期权到期 == nextThirdDeliveryKey) N = 3

                if (profileN[nextN期权到期]) {
                    期权日key = `后${N}到期` + profileN[nextN期权到期].close.split("->")[1].split(",")[0]
                }
                else if (profileN.after) {
                    期权日key = N == 1 ? `后${N}到期` + profileN.after[nextFirstDeliveryKey] : `后${N}到期` + profileN.after[nextSecondDeliveryKey]
                }
                if (!期权日key) return


                if (trig期权日Obj.hasOwnProperty(期权日key)) {
                    trig期权日Obj[期权日key].push(ele)
                }
                else {
                    trig期权日Obj[期权日key] = [ele]
                }
            })
            for (let [nextN期权到期key, trigDateArr] of Object.entries(trig期权日Obj)) {

                let nextN期权到期 = nextSecondDeliveryKey
                if (nextN期权到期key.includes("后3到期")) nextN期权到期 = nextThirdDeliveryKey

                let closeHighest = -1000000, closeHighest百分比 = -1000000
                let closeLowes = 1000000, closeLowes百分比 = 1000000
                let type = trigDateArr[0][1][0].includes("高位") ? "高位" : "低位"
                for (let trigDate of trigDateArr) {
                    let profileN = trigDate[2]
                    let closePoint = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[1] : +profileN.after.close.split(",")[1]//close 点位变化
                    let closePercent = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[2] : +profileN.after.close.split(",")[2]//baifenbi 点位变化
                    if (closePoint > closeHighest) {
                        closeHighest = closePoint
                        closeHighest百分比 = closePercent
                    }
                    if (closePoint < closeLowes) {
                        closeLowes = closePoint
                        closeLowes百分比 = closePercent
                    }
                    if (profileN?.标星) type = profileN?.标星.replace("位", "")
                }

                let trig期权日Info = [nextN期权到期key, trigDateArr, type]
                trig期权日Info.maxRatio = closeHighest百分比
                trig期权日Info.minRatio = closeLowes百分比
                trig期权日Arr.push(trig期权日Info)
            }
            trig期权日Arr.sort((a, b) => dateToStamp(b[0].substring(4)) - dateToStamp(a[0].substring(4)))
            trig期权日Arr.maxRatio统计 = {
                maxRatio中位: calMedianProf(trig期权日Arr, "maxRatio"),
                maxRatio平均: calAvgProf(trig期权日Arr, "maxRatio"),
                maxRatio最大: cal极值(trig期权日Arr, "maxRatio").max,
                maxRatio最小: cal极值(trig期权日Arr, "maxRatio").min,
            }
            trig期权日Arr.minRatio统计 = {
                minRatio中位: calMedianProf(trig期权日Arr, "minRatio"),
                minRatio平均: calAvgProf(trig期权日Arr, "minRatio"),
                minRatio最大: cal极值(trig期权日Arr, "minRatio").max,
                minRatio最小: cal极值(trig期权日Arr, "minRatio").min,
            }


            return {
                trigDateArr: trigDateArr,
                trig期权日Arr: trig期权日Arr
            }
        }
        let 基金策略高位 = 统计基金策略("高位")
        let 基金策略低位 = 统计基金策略("低位")

        let 基金策略高位ByDay = 基金策略高位.trigDateArr.filter((ele, index) => +ele[0].substring(0, 4) >= 2000)
        let 基金策略低位ByDay = 基金策略低位.trigDateArr.filter((ele, index) => +ele[0].substring(0, 4) >= 2000)
        let 基金策略高位By期权日 = 基金策略高位.trig期权日Arr
        let 基金策略低位By期权日 = 基金策略低位.trig期权日Arr

        function changeLog1(基金策略By) {
            let resultArr = []
            function toKline(profileN) {
                let key

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                if (Object.hasOwn(profileN, nextSecondDeliveryKey) && nextN期权到期 == nextSecondDeliveryKey) key = nextSecondDeliveryKey
                else if (Object.hasOwn(profileN, nextThirdDeliveryKey) && nextN期权到期 == nextThirdDeliveryKey) key = nextThirdDeliveryKey
                else key = "after"

                if (!profileN[key]) return []
                return [
                    0,
                    +profileN[key].high.split(",")[2],
                    +profileN[key].low.split(",")[2],
                    +profileN[key].close.split(",")[2],

                    key == "after" ? `after${profileN.after.close.split("->")[0]}` : key,
                    profileN[key].close.split(",")[0],
                    +profileN[key].close.split(",")[1],
                ]
            }
            resultArr = 基金策略By.map((ele, index) => {
                let newShowArr = []
                newShowArr.push(ele[0])
                newShowArr.push(ele[4].length)
                newShowArr.push(ele[5])
                newShowArr = newShowArr.concat(toKline(ele[2]))

                //console.log(ele[2])
                let testInfo = ele[2]?.testInfo ?? ""// triggerLogObj指数.日周高位九转.find(e=>e.trigDate==ele[0])?.九转详情
                newShowArr.push(ele[1] + testInfo)
                return newShowArr
            })
                //.filter((ele, index) => { return ele.at(-1).includes("日周") })
                .sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                //.sort((a, b) => a[9] - b[9])
                .map((ele, index) => {
                    if (ele[7] == nextSecondDeliveryKey) ele[7] = "后2到期"
                    if (ele[7] == nextThirdDeliveryKey) ele[7] = "后3到期"
                    return ele
                })

            return resultArr
        }
        console.groupCollapsed("基金策略高位ByDay   基金策略高位By期权日")
        console.log(changeLog1(基金策略高位ByDay), 基金策略高位By期权日)
        console.groupEnd()
        console.groupCollapsed("基金策略低位ByDay   基金策略低位By期权日")
        console.log(changeLog1(基金策略低位ByDay), 基金策略低位By期权日)
        console.groupEnd()

        //区间策略
        function 统计区间策略(区间类型 = "上升日期区间", 汇总N = 5, 过滤M = 10) {
            let 区间ByDay = {}
            let 区间By期权日 = {}
            for (let [日期区间, 区间trigDateArr] of Object.entries(triggerLogObj区间[区间类型])) {

                let trigDateArr = Object.entries(区间trigDateArr)
                    .map((ele, index, preArr) => {
                        let newArr = []
                        newArr[0] = ele[0]
                        newArr[1] = ele[1].toSpliced(-1).map((ele, index) => ele.quantName +

                            (function (ar) {
                                return ele.logInfo //""
                            })(ele.logInfo) //test

                        )
                        newArr[2] = ele[1].at(-1)
                        newArr[3] = 区间类型.includes("上升") ? " ↑ " : " ↓ " // newArr[2]?.标星 ? newArr[2]?.标星.replace("位", "") : (newArr[1][0].includes("高位") ? "高位" : "低位")
                        return newArr
                    })
                trigDateArr.forEach((ele, index) => {
                    if (index == 0) return ele[4] = "✔"
                    let last对号 = trigDateArr.findLast(ele => ele.at(-1) == "✔")
                    if (dateToStamp(ele[0]) >= dateToStamp(last对号[0]) + 过滤M * 86400000)
                        ele[5] = "✔"
                    else
                        ele[5] = "✗"
                })
                trigDateArr = trigDateArr.map((ele, index, preArr) => {
                    let 包含当天最近N天触发的日期 = preArr.filter(preArrEle => {
                        return dateToStamp(ele[0]) >= dateToStamp(preArrEle[0]) && dateToStamp(preArrEle[0]) >= dateToStamp(ele[0]) - 汇总N * 86400000
                    })
                    包含当天最近N天触发的日期.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                    ele[4] = 包含当天最近N天触发的日期
                    return ele
                })
                trigDateArr.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))


                let trig期权日Arr = [], trig期权日Obj = {}
                trigDateArr.forEach((ele, index) => {
                    let date = ele[0]
                    let trig策略s = ele[1]
                    let profileN = ele[2]

                    let nextN期权到期 = nextSecondDeliveryKey
                    let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                    for (var i = 0; i < nextArr.length; i++) {
                        let nextNDelivery到期 = nextArr[i]
                        if (profileN[nextNDelivery到期]) {
                            let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                            if (closeDay > min期权days) {
                                nextN期权到期 = nextNDelivery到期
                                break
                            }
                        }
                    }

                    let 期权日key
                    let N = 2
                    if (nextN期权到期 == nextSecondDeliveryKey) N = 2
                    if (nextN期权到期 == nextThirdDeliveryKey) N = 3
                    if (profileN[nextN期权到期]) {
                        期权日key = `后${N}到期` + profileN[nextN期权到期].close.split("->")[1].split(",")[0]
                    }
                    else if (profileN.after) {
                        期权日key = N == 1 ? `后${N}到期` + profileN.after[nextFirstDeliveryKey] : `后${N}到期` + profileN.after[nextSecondDeliveryKey]
                    }
                    if (!期权日key) return

                    if (trig期权日Obj.hasOwnProperty(期权日key)) {
                        trig期权日Obj[期权日key].push(ele)
                    }
                    else {
                        trig期权日Obj[期权日key] = [ele]
                    }
                })
                for (let [nextN期权到期key, trigDateArr] of Object.entries(trig期权日Obj)) {

                    let nextN期权到期 = nextSecondDeliveryKey
                    if (nextN期权到期key.includes("后3到期")) nextN期权到期 = nextThirdDeliveryKey

                    let closeHighest = -1000000, closeHighest百分比 = -1000000
                    let closeLowes = 1000000, closeLowes百分比 = 1000000
                    let type = 区间类型.includes("上升") ? " ↑ " : " ↓ "
                    for (let trigDate of trigDateArr) {
                        let profileN = trigDate[2]
                        let closePoint = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[1] : +profileN.after.close.split(",")[1]//close 点位变化
                        let closePercent = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[2] : +profileN.after.close.split(",")[2]//baifenbi 点位变化
                        if (closePoint > closeHighest) {
                            closeHighest = closePoint
                            closeHighest百分比 = closePercent
                        }
                        if (closePoint < closeLowes) {
                            closeLowes = closePoint
                            closeLowes百分比 = closePercent
                        }
                        //if (profileN?.标星) type = profileN?.标星.replace("位", "")
                    }

                    let trig期权日Info = [nextN期权到期key, trigDateArr, type] //
                    trig期权日Info.maxRatio = closeHighest百分比
                    trig期权日Info.minRatio = closeLowes百分比
                    trig期权日Arr.push(trig期权日Info)
                }
                trig期权日Arr.sort((a, b) => dateToStamp(b[0].substring(4)) - dateToStamp(a[0].substring(4)))
                trig期权日Arr.maxRatio统计 = {
                    maxRatio中位: calMedianProf(trig期权日Arr, "maxRatio"),
                    maxRatio平均: calAvgProf(trig期权日Arr, "maxRatio"),
                    maxRatio最大: cal极值(trig期权日Arr, "maxRatio").max,
                    maxRatio最小: cal极值(trig期权日Arr, "maxRatio").min,
                }
                trig期权日Arr.minRatio统计 = {
                    minRatio中位: calMedianProf(trig期权日Arr, "minRatio"),
                    minRatio平均: calAvgProf(trig期权日Arr, "minRatio"),
                    minRatio最大: cal极值(trig期权日Arr, "minRatio").max,
                    minRatio最小: cal极值(trig期权日Arr, "minRatio").min,
                }


                区间ByDay[日期区间] = trigDateArr
                区间By期权日[日期区间] = trig期权日Arr
            }
            return {
                区间ByDay: 区间ByDay,
                区间By期权日: 区间By期权日,
            }
        }
        let 上升区间策略 = 统计区间策略("上升日期区间")
        let 下降区间策略 = 统计区间策略("下降日期区间")
        let 上升区间ByDay = 上升区间策略.区间ByDay
        let 上升区间By期权日 = 上升区间策略.区间By期权日
        let 下降区间ByDay = 下降区间策略.区间ByDay
        let 下降区间By期权日 = 下降区间策略.区间By期权日

        上升区间By期权日.all = []
        for (const [区间Date, trigDateArr] of Object.entries(上升区间By期权日)) {
            上升区间By期权日.all = 上升区间By期权日.all.concat(trigDateArr)
        }
        下降区间By期权日.all = []
        for (const [区间Date, trigDateArr] of Object.entries(下降区间By期权日)) {
            下降区间By期权日.all = 下降区间By期权日.all.concat(trigDateArr)
        }

        function changeLog2(区间By) {
            let result = {}
            let allArr = []
            function toKline(profileN) {
                let key

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                if (Object.hasOwn(profileN, nextSecondDeliveryKey) && nextN期权到期 == nextSecondDeliveryKey) key = nextSecondDeliveryKey
                else if (Object.hasOwn(profileN, nextThirdDeliveryKey) && nextN期权到期 == nextThirdDeliveryKey) key = nextThirdDeliveryKey
                else key = "after"

                return [
                    0,
                    +profileN[key].high.split(",")[2],
                    +profileN[key].low.split(",")[2],
                    +profileN[key].close.split(",")[2],

                    key == "after" ? `after${profileN.after.close.split("->")[0]}` : key,
                    profileN[key].close.split(",")[0],
                    +profileN[key].close.split(",")[1],
                ]
            }
            for (const [区间Date, trigDateArr] of Object.entries(区间By)) {
                result[区间Date] = trigDateArr.map((ele, index) => {
                    let newShowArr = []
                    newShowArr.push(ele[0])
                    newShowArr.push(ele[3].length)
                    newShowArr.push(ele[4])
                    newShowArr = newShowArr.concat(toKline(ele[2]))
                    newShowArr.push(ele[1] + "")
                    return newShowArr
                })
                allArr = allArr.concat(result[区间Date])
            }
            result["all"] = allArr
                //.filter((ele, index) => { return ele.at(-1).includes("_one") })
                .sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                .sort((a, b) => b[6] - a[6])
                .map((ele, index) => {
                    if (ele[7] == nextSecondDeliveryKey) ele[7] = "后2到期"
                    if (ele[7] == nextThirdDeliveryKey) ele[7] = "后3到期"
                    return ele
                })

            return result
        }
        console.groupCollapsed("区间策略上区ByDay   区间策略上区By期权日")
        console.log(changeLog2(上升区间ByDay), 上升区间By期权日)
        console.groupEnd()
        console.groupCollapsed("区间策略下区ByDay   区间策略下区By期权日")
        console.log(changeLog2(下降区间ByDay), 下降区间By期权日)
        console.groupEnd()


        //全部策略合并后统计
        function 统计全部策略(高低位 = "位", 汇总N = 5, 过滤M = 10) {

            let trigDateArr指数 = Object.entries(triggerLogObj指数.按日期排序).filter((ele, index) => { return ele[1][0].includes(高低位) })
            if (标星冲突不显示) trigDateArr指数 = trigDateArr指数.filter((ele, index) => { return !ele[1].at(-1)?.冲突 }) ///标星冲突不显示

            let trigDateArr基金 = Object.entries(triggerLogObj基金).filter((ele, index) => { return ele[1][0].includes(高低位) })

            let trigDateArr期权 = []
            Object.entries(triggerLogObj区间.上升日期区间).forEach(([日期区间, 区间trigDateArr]) => {
                Object.entries(区间trigDateArr).forEach(([trigDate, trigNameObjArr]) => {
                    let newArrNames = trigNameObjArr.map((ele, index) => {
                        if (index != trigNameObjArr.length - 1) return ele.quantName
                        else return ele
                    })
                    trigDateArr期权.push([trigDate, newArrNames])
                })
            })
            Object.entries(triggerLogObj区间.下降日期区间).forEach(([日期区间, 区间trigDateArr]) => {
                Object.entries(区间trigDateArr).forEach(([trigDate, trigNameObjArr]) => {
                    let newArrNames = trigNameObjArr.map((ele, index) => {
                        if (index != trigNameObjArr.length - 1) return ele.quantName
                        else return ele
                    })
                    trigDateArr期权.push([trigDate, newArrNames])
                })
            })


            trigDateArr = [...trigDateArr指数, ...trigDateArr基金, ...trigDateArr期权]
            trigDateArr.sort((a, b) => dateToStamp(a[0]) - dateToStamp(b[0]))


            const dateMap = new Map();
            trigDateArr.forEach(([date, arr]) => {
                if (dateMap.has(date)) {
                    dateMap.get(date).unshift(...arr.toSpliced(-1));
                    if (arr.at(-1)?.标星) { dateMap.get(date).pop(); dateMap.get(date).push(arr.at(-1)); }
                } else {
                    dateMap.set(date, [...arr]);
                }
            });
            trigDateArr = Array.from(dateMap.entries());


            function get星位箭头(trigNames, profileN) {
                if (profileN?.标星) return profileN?.标星.replace("位", "")
                let allIs位_ = trigNames.every(name => name.includes("位_"))
                if (allIs位_) return trigNames[0].includes("高位") ? " ↓ " : " ↑ "
                return trigNames[0].includes("高位") ? "高位" : "低位"
            }
            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let newArr = []
                newArr[0] = ele[1].at(-1)?.kDate ?? ele[0] //kDate 基金触发日不一定是交易日 
                newArr[1] = ele[1].toSpliced(-1) //['上证高位_红但down死叉', '上证50高位_红但down死叉']
                newArr[2] = ele[1].at(-1) //{…}
                newArr[3] = get星位箭头(newArr[1], newArr[2])
                return newArr
            })



            function is反向(当前星位箭头, 上次星位箭头) {
                if ((当前星位箭头.includes("高位") || 当前星位箭头.includes(" ↓ ")) && (上次星位箭头.includes("低位") || 上次星位箭头.includes(" ↑ "))) {
                    return true
                }
                if ((当前星位箭头.includes("低位") || 当前星位箭头.includes(" ↑ ")) && (上次星位箭头.includes("高位") || 上次星位箭头.includes(" ↓ "))) {
                    return true
                }
                return false
            }
            trigDateArr.forEach((ele, index) => {
                if (index == 0) return ele[5] = "✔"
                let last对号 = trigDateArr.findLast(ele => ele.at(-1) == "✔")
                if (dateToStamp(ele[0]) >= dateToStamp(last对号[0]) + 过滤M * 86400000)
                    ele[5] = "✔"
                else if (is反向(ele[3], last对号[3]))
                    ele[5] = "✔"
                else
                    ele[5] = "✗"
            })

            trigDateArr = trigDateArr.map((ele, index, preArr) => {
                let 包含当天最近N天触发的日期 = preArr.filter(preArrEle => {
                    return dateToStamp(ele[0]) >= dateToStamp(preArrEle[0]) && dateToStamp(preArrEle[0]) >= dateToStamp(ele[0]) - 汇总N * 86400000
                })
                包含当天最近N天触发的日期.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))
                ele[4] = 包含当天最近N天触发的日期
                return ele
            })
            trigDateArr.sort((a, b) => dateToStamp(b[0]) - dateToStamp(a[0]))


            let trig期权日Arr = [], trig期权日Obj = {}
            trigDateArr.forEach((ele, index) => {
                let date = ele[0]
                let trig策略s = ele[1]
                let profileN = ele[2]
                let 位箭 = ele[3]

                let nextN期权到期 = nextSecondDeliveryKey
                let nextArr = [nextSecondDeliveryKey, nextThirdDeliveryKey]
                for (var i = 0; i < nextArr.length; i++) {
                    let nextNDelivery到期 = nextArr[i]
                    if (profileN[nextNDelivery到期]) {
                        let closeDay = +profileN[nextNDelivery到期].close.split("->")[0]
                        if (closeDay > min期权days) {
                            nextN期权到期 = nextNDelivery到期
                            break
                        }
                    }
                }

                let 期权日key
                let N = 2
                if (nextN期权到期 == nextFirstDeliveryKey) N = 1
                if (nextN期权到期 == nextThirdDeliveryKey) N = 3

                if (profileN[nextN期权到期]) {
                    期权日key = `后${N}到期` + profileN[nextN期权到期].close.split("->")[1].split(",")[0]
                }
                else if (profileN.after) {
                    期权日key = N == 1 ? `后${N}到期` + profileN.after[nextFirstDeliveryKey] : `后${N}到期` + profileN.after[nextSecondDeliveryKey]
                }
                if (!期权日key) return

                if (位箭.includes("高") || 位箭.includes(" ↓ ")) 期权日key = "沽" + 期权日key
                else if (位箭.includes("低") || 位箭.includes(" ↑ ")) 期权日key = "购" + 期权日key


                if (trig期权日Obj.hasOwnProperty(期权日key)) {
                    trig期权日Obj[期权日key].push(ele)
                }
                else {
                    trig期权日Obj[期权日key] = [ele]
                }
            })

            for (let [nextN期权到期key, trigDateArr] of Object.entries(trig期权日Obj)) {

                let nextN期权到期 = nextSecondDeliveryKey
                if (nextN期权到期key.includes("后3到期")) nextN期权到期 = nextThirdDeliveryKey

                let closeHighest = -1000000, closeHighest百分比 = -1000000
                let closeLowes = 1000000, closeLowes百分比 = 1000000
                let type = [...new Set(trigDateArr.map(item => item[3]))]
                for (let trigDate of trigDateArr) {
                    let profileN = trigDate[2]
                    let closePoint = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[1] : +profileN.after.close.split(",")[1]//close 点位变化
                    let closePercent = typeof profileN[nextN期权到期] !== "undefined" ? +profileN[nextN期权到期].close.split(",")[2] : +profileN.after.close.split(",")[2]//baifenbi 点位变化
                    if (closePoint > closeHighest) {
                        closeHighest = closePoint
                        closeHighest百分比 = closePercent
                    }
                    if (closePoint < closeLowes) {
                        closeLowes = closePoint
                        closeLowes百分比 = closePercent
                    }
                }

                let trig期权日Info = [nextN期权到期key, trigDateArr, type + ""]
                trig期权日Info.maxRatio = closeHighest百分比
                trig期权日Info.minRatio = closeLowes百分比
                trig期权日Arr.push(trig期权日Info)
            }
            trig期权日Arr.sort((a, b) => dateToStamp(b[0].substring(4)) - dateToStamp(a[0].substring(4)))
            trig期权日Arr.maxRatio统计 = {
                maxRatio中位: calMedianProf(trig期权日Arr, "maxRatio"),
                maxRatio平均: calAvgProf(trig期权日Arr, "maxRatio"),
                maxRatio最大: cal极值(trig期权日Arr, "maxRatio").max,
                maxRatio最小: cal极值(trig期权日Arr, "maxRatio").min,
            }
            trig期权日Arr.minRatio统计 = {
                minRatio中位: calMedianProf(trig期权日Arr, "minRatio"),
                minRatio平均: calAvgProf(trig期权日Arr, "minRatio"),
                minRatio最大: cal极值(trig期权日Arr, "minRatio").max,
                minRatio最小: cal极值(trig期权日Arr, "minRatio").min,
            }

            return {
                trigDateArr: trigDateArr,
                trig期权日Arr: trig期权日Arr
            }
        }
        let 全部策略 = 统计全部策略("位")
        let 全部策略ByDay = 全部策略.trigDateArr.filter((ele, index) => +ele[0].substring(0, 4) >= 2000)
        let 全部策略By期权日 = 全部策略.trig期权日Arr
        console.groupCollapsed("全部策略ByDay       全部策略By期权日")
        console.log(changeLog1(全部策略ByDay), 全部策略By期权日)
        console.groupEnd()
        console.log("    ")
    </script>

    <script>
        function isNumber(value) {
            return typeof value === 'number' && !isNaN(value);
        }
        function arrayHasIndex(arr, index) {
            return Array.isArray(arr) && index >= 0 && index < arr.length && !(arr[index] == null);
        }
        function roundToHighestPlace(num) {
            //123 => 100 将任意数字转换为最高位保留，其他位变为0的函数。
            if (num === 0) return 0;
            num = parseInt(num)
            const numStr = Math.abs(num).toString();
            const firstDigit = numStr[0];
            const zeros = "0".repeat(numStr.length - 1);
            const result = parseInt(firstDigit + zeros, 10);
            return num < 0 ? -result : result;
        }
        function get标的资产ByDate(etfList, date) {
            let curKInfoIndex = etfList.findIndex(e => e.date == date)
            if (curKInfoIndex <= -1) {
                let Nlist = [-1, -2, -3, -4, -5, 1, 2]
                for (let index = 0; index < Nlist.length; index++) {// "2018-12-31"
                    let preNexDay = getPreNexDate(date, Nlist[index])
                    curKInfoIndex = etfList.findIndex(ele => { return ele.date == preNexDay })
                    if (curKInfoIndex > -1) break
                }
            }
            if (curKInfoIndex <= -1) {
                console.log("无法找到对应数据日期", date)
                return null
            }
            etfList[curKInfoIndex].index = curKInfoIndex
            return etfList[curKInfoIndex]
        }

        //合并所有期权日 两种合并方式
        // let allBy期权日 = [...指数策略高位By期权日, ...指数策略低位By期权日, ...基金策略高位By期权日, ...基金策略低位By期权日, ...上升区间By期权日.all, ...下降区间By期权日.all].map((ele, index) => {
        //     let 位箭 = ele[2]
        //     if (位箭.includes("高") || 位箭.includes(" ↓ ")) ele[0] = "沽" + ele[0]
        //     else if (位箭.includes("低") || 位箭.includes(" ↑ ")) ele[0] = "购" + ele[0]
        //     return ele
        // })
        let allBy期权日 = 全部策略By期权日
        allBy期权日.sort((a, b) => dateToStamp(b[0].substring(4)) - dateToStamp(a[0].substring(4)))

        //标记
        function calDayWeekMonthKline(nameCode, kline交易日) {
            nameCode.currentDayList = []
            nameCode.currentWeekList = []
            nameCode.currentMonthList = []
            let currentDayIndex = nameCode.dayDatas.findIndex(ele => { return ele.date == kline交易日 });
            if (currentDayIndex > 70) {
                let dayStart = (currentDayIndex + 1) - 100 > 0 ? (currentDayIndex + 1) - 100 : 0 //day计算最近100天
                nameCode.currentDayList = nameCode.dayDatas.slice(dayStart, currentDayIndex + 1)
                    .calBoll().cal9转(kline交易日, "day").calKdj().calMacd().maN(10, "close")
                nameCode.currentDayList = calculationBias(nameCode.currentDayList)
                nameCode.currentDayList = calculationCci(nameCode.currentDayList)

                let weekDayStart = (currentDayIndex + 1) - 500 > 0 ? (currentDayIndex + 1) - 500 : 0 //week最近100周500天
                nameCode.currentWeekList = dayToPeriod(nameCode.dayDatas.slice(weekDayStart, currentDayIndex + 1), "week")
                    .calBoll().cal9转(kline交易日, "week").calKdj().calMacd().maN(10, 'close')
                nameCode.currentWeekList = calculationBias(nameCode.currentWeekList)
                nameCode.currentWeekList = calculationCci(nameCode.currentWeekList)

                let monthDayStart = 0 //month全部
                nameCode.currentMonthList = dayToPeriod(nameCode.dayDatas.slice(monthDayStart, currentDayIndex + 1), "month")
                    .calBoll().cal9转(kline交易日, "month").calKdj().calMacd()
                    .maN(3, 'close').maN(5, 'close').maN(10, 'close').maN(80, 'close')
                nameCode.currentMonthList = calculationBias(nameCode.currentMonthList)
                nameCode.currentMonthList = calculationCci(nameCode.currentMonthList)
            }
            return nameCode
        }

        for (let index = 0; index < allBy期权日.length; index++) {
            let element = allBy期权日[index]
            if (+element[1].at(-1)[0].substring(0, 4) < 2013) continue

            let count = 1
            let kInfoArr = []

            function upAllPre(curk) {
                let res = true
                for (var i = 0; i < kInfoArr.length; i++) {
                    let preiK = kInfoArr[i]
                    res = res && (preiK.close <= curk.close)
                }
                return res
            }
            function lowAllPre(curk) {
                let res = true
                for (var i = 0; i < kInfoArr.length; i++) {
                    let preiK = kInfoArr[i]
                    res = res && (preiK.close >= curk.close)
                }
                return res
            }
            function allow高位(curKInfo, trigArr, trigArrIndex) {
                //空 十字 
                let cond0 = true &&
                    trigArr[trigArrIndex][3] == "高★" &&
                    curtPercent(curKInfo) >= 0 &&
                    curKInfo.percent >= 0 &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 5 ||
                        trigArr[trigArrIndex][1].length >= 3
                    )
                if (cond0) return true

                let cond1 = true &&
                    trigArr[trigArrIndex][3] == "高★" &&
                    (trigArr[trigArrIndex][1] + "").includes("VKM多叉")
                if (cond1) return true

                let cond2 = true &&
                    upAllPre(curKInfo) &&
                    curtPercent(curKInfo) > 0 &&
                    curKInfo.percent > 0 &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 5 ||
                        trigArr[trigArrIndex][1].length >= 3
                    )
                if (cond2) return true

                let cond3 = true &&
                    upAllPre(curKInfo) &&
                    (curtPercent(curKInfo) > 0 || curKInfo.percent > 0) &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 7 ||
                        trigArr[trigArrIndex][1].length >= 4
                    )
                if (cond3) return true


            }
            function allow低位(curKInfo, trigArr, trigArrIndex) {

                //2024-09-23
                let cond_2 = true &&
                    trigArr[trigArrIndex][3] == "低★" &&
                    (trigArr[trigArrIndex][1] + "").includes("VKM多叉")
                if (cond_2) return true

                let cond_1 = true &&
                    trigArr[trigArrIndex][3] == "低★" &&
                    (trigArr[trigArrIndex][1] + "").includes("PK") && //基金
                    (
                        (trigArr[trigArrIndex][1] + "").includes("低位B") ||
                        trigArr[trigArrIndex][1].length >= 3
                    )
                if (cond_1) return true

                let cond0 = true &&
                    trigArr[trigArrIndex][3] == "低★" &&
                    curtPercent(curKInfo) <= 0 &&
                    curKInfo.percent <= 0 &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 5 ||
                        trigArr[trigArrIndex][1].length >= 3
                    )
                if (cond0) return true


                let cond1 = true &&
                    lowAllPre(curKInfo) &&
                    curtPercent(curKInfo) < 0 &&
                    curKInfo.percent < 0 &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 5 ||
                        trigArr[trigArrIndex][1].length >= 3
                    )
                if (cond1) return true

                let cond2 = true &&
                    lowAllPre(curKInfo) &&
                    (curtPercent(curKInfo) < 0 || curKInfo.percent < 0) &&
                    (
                        curKInfo.index - kInfoArr.at(-1).index > 7 ||
                        trigArr[trigArrIndex][1].length >= 4
                    )//2022-10-31
                if (cond2) return true
            }

            for (let idx = element[1].length - 1; idx >= 0; idx--) {
                let curKInfo = get标的资产ByDate(期权标的资产, element[1][idx][0])
                kInfoArr.unshift(curKInfo)
                if (idx == element[1].length - 1) {
                    let oldfuhao = element[1][idx].pop()
                    element[1][idx].push(oldfuhao + "-&") //first
                    continue
                } else {
                    if (element[2].includes("↓") || element[2].includes("高")) {
                        if (allow高位(curKInfo, element[1], idx)) {
                            let oldfuhao = element[1][idx].pop()
                            element[1][idx].push(oldfuhao + "-&")
                            count++
                        }
                    } else {
                        if (allow低位(curKInfo, element[1], idx)) {
                            let oldfuhao = element[1][idx].pop()
                            element[1][idx].push(oldfuhao + "-&")
                            count++
                        }
                    }
                }
            }
            element.count = count
        }

        //抽取22-4-27  22-3-23
        let 区间策略建议ByDay = []
        for (let index = allBy期权日.length - 1; index >= 0; index--) {
            const element = allBy期权日[index]
            let endDate = element[0].substring(5)

            if (+endDate.substring(0, 4) < 2015) continue
            if (endDate < "2020-02-21") { cur期权标的资产 = 上证50ETF; cur期权标的资产Name = "上证50ETF"; }
            else { cur期权标的资产 = 期权标的资产; cur期权标的资产Name = 期权标的资产Name; }

            for (let atId = -1; atId >= (0 - element[1].length); atId--) {
                const eleArr = element[1]
                if (atId !== -1 && !eleArr.at(atId).at(-1).includes("-&")) continue
                let startDate = eleArr.at(atId)[0]
                let startClose = get标的资产ByDate(cur期权标的资产, startDate).close
                startClose = +startClose.toFixed(3)

                let 星位箭 = eleArr.at(atId)[3]
                let direType = "购"
                let excpEndClose = +(startClose * 1.03).toFixed(3)
                if (星位箭.includes("↓") || 星位箭.includes("高")) {
                    direType = "沽"
                    excpEndClose = +(startClose * 0.97).toFixed(3)
                }

                let pushArr = [startDate, endDate, 星位箭, `${startClose} ${direType}${cur期权标的资产Name} ${excpEndClose}`]
                pushArr.tAr = eleArr.at(atId)[1] + ""
                区间策略建议ByDay.unshift(pushArr)
            }
        }

        区间策略建议ByDay = Array.from(new Map(
            区间策略建议ByDay.map(item => [`${item[0]}-${item[1]}`, item])
        ).values())

    </script>

    <script type="text/javascript" src="./js/xlsx.full.min.js"></script>
    <script type="text/javascript" src="./cnThs/今收/同花顺策略组1_信号统计.js"></script>
    <script type="text/javascript" src="./cnThs/今收/同花顺策略组2_大小市值信号统计.js"></script>
    <script>
        if (typeof 技术指标统计 === "undefined") var 技术指标统计 = []
        if (typeof 小市值低估 === "undefined") var 小市值低估 = []
        if (typeof 大市值趋势 === "undefined") var 大市值趋势 = []
        技术指标统计 = 技术指标统计.filter(ele => (ele[1] >= 3 || ele[2].length >= 2))


        let 手动买卖 = [
            ["2025-11-25", "2026-01-16", " ↑ ", '4490.4 购沪深300手动 4625.112', 'io2601购4600:53张', 2.3, '2025-11-26', 57.4, 3837, '2026-01-16开', 182, 8851],
            ['2025-10-28', '2025-12-24', '高位', '4.802 沽沪深300ETF手动 4.658', '2025-12-24沽4700:34张', 1.91, '2025-10-29', 0.0888, 30532, '提前P1:2025-11-25开', 0.1701, 58485],
        ]

        let 模拟买卖 = [
            ["2025-08-19", "2025-10-17", " ↑ ", "4223.37 购沪深300模拟 4350.071", "IO2510-C-4350.xlsx"],
            ["2025-08-11", "2025-09-19", " ↑ ", "4122.51 购沪深300模拟 4246.185", "IO2509-C-4200.xlsx"],
            ["2025-06-23", "2025-08-15", " ↑ ", "3857.9 购沪深300模拟 3973.637", "IO2508-C-3950.xlsx"],
            ["2025-05-29", "2025-07-18", " ↑ ", "3858.7 购沪深300模拟 3974.461", "IO2507-C-3950.xlsx"],
            ["2025-05-06", "2025-06-20", " ↑ ", "3808.54 购沪深300模拟 3922.796", "IO2506-C-3900.xlsx"],
            ["2025-04-07", "2025-05-16", " ↑ ", "3589.44 购沪深300模拟 3697.123", "IO2505-C-3650.xlsx"],
            ["2025-03-19", "2025-04-18", "高位", "4010.17 沽沪深300模拟 3889.865", "IO2504-P-3900.xlsx"],
            ["2025-01-13", "2025-02-21", " ↑ ", "3722.51 购沪深300模拟 3834.185", "IO2502-C-3800.xlsx"],

            ["2024-10-08", "2024-11-15", "高位", "4256.1 沽沪深300模拟 4128.417", "IO2411-P-4150.xlsx"],
            ["2024-09-27", "2024-11-15", "低★", "3703.68 购沪深300模拟 3814.79", "IO2411-C-3800.xlsx"],
            ["2024-09-23", "2024-11-15", "低★", "3212.76 购沪深300模拟 3309.143", "IO2411-C-3300.xlsx"],
            ["2024-09-20", "2024-11-15", "低★", "3201.05 购沪深300模拟 3297.082", "IO2411-C-3250.xlsx"],
            ["2024-09-18", "2024-11-15", "低★", "3171.01 购沪深300模拟 3266.14", "IO2411-C-3250.xlsx"],
            ["2024-09-13", "2024-11-15", "低位", "3159.25 购沪深300模拟 3254.028", "IO2411-C-3250.xlsx"],
            ["2024-09-11", "2024-11-15", "低位", "3186.13 购沪深300模拟 3281.714", "IO2411-C-3250.xlsx"],

            ["2024-09-10", "2024-10-18", "低★", "3195.76 购沪深300模拟 3291.633", "IO2410-C-3300.xlsx"],
            ["2024-09-06", "2024-10-18", "低★", "3231.35 购沪深300模拟 3328.291", "IO2410-C-3300.xlsx"],
            ["2024-09-02", "2024-10-18", "低★", "3265.01 购沪深300模拟 3362.96", "IO2410-C-3350.xlsx"],
            ["2024-08-27", "2024-10-18", "低位", "3305.33 购沪深300模拟 3404.49", "IO2410-C-3400.xlsx"],
            ["2024-05-13", "2024-06-21", "高位", "3664.69 沽沪深300模拟 3554.749", "IO2406-P-3550.xlsx"],
            ["2024-04-16", "2024-06-21", " ↑ ", "3511.11 购沪深300模拟 3616.443", "IO2406-C-3550.xlsx"],
            ["2024-04-15", "2024-05-17", " ↑ ", "3549.08 购沪深300模拟 3655.552", "IO2405-C-3650.xlsx"],
            ["2024-02-05", "2024-03-15", "低★", "3200.42 购沪深300模拟 3296.433", "IO2403-C-3300.xlsx"],
            ["2024-02-02", "2024-03-15", "低★", "3179.63 购沪深300模拟 3275.019", "IO2403-C-3300.xlsx"],
            ["2024-01-22", "2024-03-15", "低★", "3218.9 购沪深300模拟 3315.467", "IO2403-C-3350.xlsx"],
            ["2024-01-18", "2024-03-15", "低★", "3274.73 购沪深300模拟 3372.972", "IO2403-C-3350.xlsx"],
            ["2023-12-27", "2024-02-19", " ↑ ", "3336.36 购沪深300模拟 3436.451", "IO2402-C-3400.xlsx"],
            ["2023-08-29", "2023-10-20", "高位", "3790.11 沽沪深300模拟 3676.407", "IO2310-P-3700.xlsx"],
            ["2023-04-11", "2023-05-19", "高位", "4100.15 沽沪深300模拟 3977.145", "IO2305-P-4000.xlsx"],
            ["2023-01-30", "2023-03-17", "高位", "4201.35 沽沪深300模拟 4075.31", "IO2303-P-4100.xlsx"],
            ["2022-12-27", "2023-02-17", " ↑ ", "3887.85 购沪深300模拟 4004.486", "IO2302-C-4000.xlsx"],
            ["2022-10-28", "2022-12-16", "低位", "3541.33 购沪深300模拟 3647.57", "IO2212-C-3600.xlsx"],
            ["2022-08-22", "2022-10-21", " ↓ ", "4181.4 沽沪深300模拟 4055.958", "IO2210-P-4100.xlsx"],
            ["2022-08-15", "2022-09-16", " ↓ ", "4185.68 沽沪深300模拟 4060.11", "IO2209-P-4100.xlsx"],
            ["2022-06-30", "2022-08-19", " ↓ ", "4485.01 沽沪深300模拟 4350.46", "IO2208-P-4350.xlsx"],
            ["2022-04-26", "2022-06-17", "低位", "3784.12 购沪深300模拟 3897.644", "IO2206-C-3900.xlsx"],
            ["2022-04-25", "2022-06-17", "低位", "3814.91 购沪深300模拟 3929.357", "IO2206-C-3900.xlsx"],
            ["2022-04-08", "2022-05-20", " ↓ ", "4230.77 沽沪深300模拟 4103.847", "IO2205-P-4100.xlsx"],
            ["2022-03-28", "2022-05-20", " ↓ ", "4148.47 沽沪深300模拟 4024.016", "IO2205-P-4100.xlsx"],
            ["2022-02-23", "2022-04-15", " ↓ ", "4623.05 沽沪深300模拟 4484.359", "IO2204-P-4500.xlsx"],
            ["2022-01-24", "2022-03-18", "高位", "4786.74 沽沪深300模拟 4643.138", "IO2203-P-4700.xlsx"],
            ["2022-01-21", "2022-03-18", "高位", "4779.31 沽沪深300模拟 4635.931", "IO2203-P-4700.xlsx"],
            ["2022-01-06", "2022-02-18", " ↓ ", "4818.23 沽沪深300模拟 4673.683", "IO2202-P-4700.xlsx"],
            ["2021-11-25", "2022-01-21", " ↓ ", "4896.44 沽沪深300模拟 4749.547", "IO2201-P-4800.xlsx"],

            ["2021-07-15", "2021-08-20", " ↓ ", "5151.46 沽沪深300模拟 4996.916", "IO2108-P-5000.xlsx"],
            ["2021-05-27", "2021-07-16", " ↓ ", "5338.23 沽沪深300模拟 5178.083", "IO2107-P-5200.xlsx"],
            ["2021-02-19", "2021-04-16", "高★", "5778.84 沽沪深300模拟 5605.475", "IO2104-P-5600.xlsx"],
            ["2021-02-18", "2021-03-19", "高★", "5768.38 沽沪深300模拟 5595.329", "IO2103-P-5600.xlsx"],
            ["2021-02-08", "2021-03-19", "高位", "5564.56 沽沪深300模拟 5397.623", "IO2103-P-5400.xlsx"],
            ["2020-12-28", "2021-02-19", " ↑ ", "5064.41 购沪深300模拟 5216.342", "IO2102-C-5200.xlsx"],
            ["2020-12-17", "2021-02-19", " ↑ ", "5017.48 购沪深300模拟 5168.004", "IO2102-C-5100.xlsx"],
            ["2020-12-01", "2021-01-15", " ↑ ", "5067.1 购沪深300模拟 5219.113", "IO2101-C-5200.xlsx"],
            ["2020-10-19", "2020-12-18", " ↑ ", "4755.49 购沪深300模拟 4898.155", "IO2012-C-4900.xlsx"],
            ["2020-10-09", "2020-11-20", " ↑ ", "4681.14 购沪深300模拟 4821.574", "IO2011-C-4800.xlsx"],
            ["2020-05-28", "2020-07-17", " ↑ ", "3856.63 购沪深300模拟 3972.329", "IO2007-C-3900.xlsx"],
            ["2020-03-23", "2020-05-15", " ↑ ", "3530.31 购沪深300模拟 3636.219", "IO2005-C-3600.xlsx"],

            //ETF分红派息导致不准确,不利于沽空,有利于购,这里只是模拟下。 ETF结束日期是第四个周三稍晚于指数的。 
            ["2019-11-25", "2019-12-25", " ↑ ", "2.726 购上证50ETF模拟 2.808", "2019-12-25购2800.xlsx"],
            ["2019-05-27", "2019-07-24", " ↑ ", "2.471 购上证50ETF模拟 2.545", "2019-07-24购2500.xlsx"],
            ["2019-04-19", "2019-06-26", "高位", "2.753 沽上证50ETF模拟 2.67", "2019-06-26沽2700.xlsx"],
            ["2019-04-08", "2019-05-22", "高位", "2.68 沽上证50ETF模拟 2.6", "2019-05-22沽2600.xlsx"],
        ];
        //模拟买卖 = []

        String.prototype.unif高低位 = function (search, replacement) {
            var target = this;
            target = target.replace("★", "位").replace(" ↓ ", "高位").replace(" ↑ ", "低位").substring(0, 2);
            return target;
        };
        function filterArrayBySecondElement(arr, N) {
            // 用于记录每个第二个元素值在从后往前遍历中的遇到次数
            const countMap = {};
            // 初始化一个布尔数组，标记每个索引是否保留
            const keepFlags = new Array(arr.length).fill(false);

            // 从后往前遍历数组（从最后一个元素到第一个元素）
            for (let i = arr.length - 1; i >= 0; i--) {
                const endDate = arr[i][1];
                const direct = arr[i][2].unif高低位()
                const endDateDirect = endDate + direct
                // 初始化计数（如果未遇到过该值）
                if (!countMap.hasOwnProperty(endDateDirect)) {
                    countMap[endDateDirect] = [];
                }
                // 增加遇到次数
                if (countMap[endDateDirect].length == 0) {
                    countMap[endDateDirect].push(arr[i][2]);
                    keepFlags[i] = true;//第一次肯定要
                }
                else if (countMap[endDateDirect].length == 1 && (arr[i][2].includes("位") || arr[i][2].includes("★"))) {
                    countMap[endDateDirect].push(arr[i][2]);
                    keepFlags[i] = true;//第2次后只要 位 和 ★
                }
                else if (countMap[endDateDirect].length < N && arr[i][2].includes("★")) {
                    countMap[endDateDirect].push(arr[i][2]);
                    keepFlags[i] = true;//第3到N次后只要★ 最多N次
                }
            }

            // 从前往后收集保留的子数组，以保持原始顺序
            const result = [];
            for (let i = 0; i < arr.length; i++) {
                if (keepFlags[i]) {
                    result.push(arr[i]);
                }
            }
            return result;
        }

        let 期权startDate = decodeURI(getQueryVariable("optStartDate"));
        let 期权endDate = decodeURI(getQueryVariable("optEndDate"));
        if (期权startDate == "false") 期权startDate = "2020-01-01" //默认设置开始日期同时减小计算量
        if (期权endDate == "false") 期权endDate = "9999-09-09" //默认结束

        let 期权买卖List = structuredClone(区间策略建议ByDay)
            .filter(ele => 期权startDate <= ele[0] && ele[0] <= 期权endDate)
            .filter(ele => !(ele[0].includes("2024-09") || ele[0].includes("2024-08")))
            .map((ele, index) => {
                let s1 = 模拟买卖.find((e) => ele[0] + ele[1] + ele[2].unif高低位() == e[0] + e[1] + e[2].unif高低位());
                if (s1) { ele[3] = s1[3]; ele[4] = s1[4]; return ele; }//模拟
                else {
                    s1 = 模拟买卖.find((e) => ele[1] + ele[2].unif高低位() == e[1] + e[2].unif高低位());
                    if (s1) { ele[3] = s1[3]; ele[4] = s1[4]; return ele; }//模拟
                    else if (ele[3].includes("ETF")) {
                        s1 = 模拟买卖.find((e) => ele[0] + ele[1].substring(0, 7) + ele[2].unif高低位() == e[0] + e[1].substring(0, 7) + e[2].unif高低位());
                        if (s1) { ele[1] = s1[1]; ele[3] = s1[3]; ele[4] = s1[4]; return ele; }//模拟ETF
                    }
                }

                let s2 = 手动买卖.find((e) => ele[0] + ele[1] + ele[2].unif高低位() == e[0] + e[1] + e[2].unif高低位());
                if (s2) { s2.tAr = ele.tAr; return s2 }//手动
                else {
                    s2 = 手动买卖.find((e) => ele[0] + ele[1].substring(0, 7) + ele[2].unif高低位() == e[0] + e[1].substring(0, 7) + e[2].unif高低位());
                    if (s2) { s2.tAr = ele.tAr; return s2 }//手动
                }

                if (ele[0] < "2020-01-01" && ele[3].includes("ETF")) return null
                return ele //未决
            })
            .filter(e => e !== null)

        期权买卖List = filterArrayBySecondElement(期权买卖List, 5)

        console.groupCollapsed("allBy期权日  区间策略建议ByDay  期权买卖List")
        console.log(allBy期权日, 区间策略建议ByDay, 期权买卖List)
        console.groupEnd()
        console.log("    ")

    </script>

    <script>
        String.prototype.leftAppend = function () {
            var target = this;
            return "           " + target;
        };
        let randomProfileArr = [];
        function gerRandomProfile(priceProfile, mean = 0, stdDev = 0.3) {
            if (priceProfile > 1) return 1
            if (priceProfile < 0) return -1
            return priceProfile

            let result;
            do {
                // Box-Muller变换生成标准正态分布
                const u1 = Math.random();
                const u2 = Math.random();

                // 避免除零错误
                if (u1 === 0) continue;

                // 生成标准正态分布随机数
                const z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);

                // 应用均值和标准差
                result = mean + z0 * stdDev;

                // 循环直到值落在[-1, 1]区间内
            } while (result < -1 || result > 1);
            randomProfileArr.push(result);
            return result;


            return +(Math.random() * 2 - 1).toFixed(4) //[-1,1) 随机 -1到2-1之间
        }
        function isNumber(value) {
            return typeof value === "number" && !isNaN(value);
        }
        function cloneAsset(asset, hastAr = true) {
            if (hastAr) return structuredClone(asset)
            else return JSON.parse(JSON.stringify(asset))
        }
        function excelSerialToDate(excelSerial) {
            // Excel 日期序列从 1900-01-01 开始为 1，但 JavaScript 使用 1970-01-01 为基准
            // Excel 的 1900 年被错误视为闰年，因此使用 1899-12-30 作为基准可自动处理该问题
            const baseDate = new Date("1899-12-30");
            const resultDate = new Date(baseDate.getTime() + excelSerial * 24 * 60 * 60 * 1000);

            // 格式化为 YYYY-MM-DD
            const year = resultDate.getFullYear();
            const month = String(resultDate.getMonth() + 1).padStart(2, "0");
            const day = String(resultDate.getDate()).padStart(2, "0");

            return `${year}-${month}-${day}`;
        }

        let liveServerUrl = "https://oowuyue.github.io/notebook/"
        if (devTestEnv) liveServerUrl = "http://127.0.0.1:5500/tempData/"
        let liveServerOk = true
        async function readExcel(excelFileName) {
            try {
                let dir = excelFileName.includes("IO") ? "指数期权excel" : "ETF期权excel"
                const fileUrl = `${liveServerUrl}${dir}/${excelFileName}`
                const file = await (await fetch(fileUrl)).arrayBuffer();
                const fileContent = XLSX.read(file);
                const sheetName = fileContent.SheetNames[0]; // 获取第一张 sheet 的名字
                const sheet = fileContent.Sheets[sheetName]; // 获取第一张 sheet 的数据
                const jsonData = XLSX.utils.sheet_to_json(sheet); // 将数据转换为 JSON 格式
                jsonData.pop();
                return jsonData.map((ele, index) => {
                    ele.交易时间 = excelSerialToDate(ele.交易时间);
                    return ele;
                });
            } catch (error) {
                return false
            }
        }

        let asset = {
            现金: 0,
            期权: [],
        };
        let 总入金 = 0;
        let 总buyCash = 0;
        let 总sellCash = 0;
        let 总费用 = 0;
        let need入金 = {};
        let preStartDate;
        let preEndDate;

        const 模拟盈亏 = false
        const 默认卖出到期类型 = 0 //默认0最后一天 -N提前N 卖出
        const 默认卖出开or收 = "开盘价" //默认开收卖出

        const 单次最小投资 = 3000;
        const 单次最大投资 = 30000;
        const etf费用 = 5
        const etf倍数 = 10000
        const 指数费用 = 15
        const 指数倍数 = 100

        const startOldestIndex = 沪深300.findIndex(e => e.date == 期权买卖List.at(-1)[0]);

        const optionContractIndex = 4;
        const profileIndex = 5;
        const buyDateIndex = 6;
        const buyPriceIndex = 7;
        const buyCashIndex = 8;
        const sellDateIndex = 9;
        const sellPriceIndex = 10;
        const sellCashIndex = 11;

        function need入金groupByYear(input) {
            const result = {};
            for (const [key, value] of Object.entries(input)) {
                // 提取键中的起始年份（第一个日期的前4个字符）
                const startDate = key.split(' ')[0];
                const year = startDate.substring(0, 4);

                // 如果年份组不存在，则初始化一个对象，包含 sum 属性
                if (!result[year]) {
                    result[year] = { sum: 0 };
                }

                // 将当前键值对添加到年份组中
                result[year][key] = value;

                // 更新总和
                result[year].sum += value;
                result[year].sum = +result[year].sum.toFixed(2)
            }
            return result;
        }
        function getBuyCashAnd入金(curBuy, 预估type = "") {
            let 单张费用 = curBuy[3].includes("ETF") ? etf费用 : 指数费用
            let 期权倍数 = curBuy[3].includes("ETF") ? etf倍数 : 指数倍数

            if (预估type == "预估ETF") {
                单张费用 = etf费用
                期权倍数 = etf倍数
            }
            if (预估type == "预估指数") {
                单张费用 = 指数费用
                期权倍数 = 指数倍数
            }

            let buyCash = 0;
            let curBuy入金 = 0;
            let 百分比 = 0.1;

            if (asset.现金 * 百分比 > 单次最大投资) buyCash = 单次最大投资;
            else if (asset.现金 * 百分比 >= 单次最小投资 && asset.现金 * 百分比 <= 单次最大投资) buyCash = roundToHighestPlace(asset.现金 * 百分比);
            else buyCash = 单次最小投资;

            let buyCount;
            if (curBuy.length >= buyPriceIndex) {
                let optionStartPrice = curBuy[buyPriceIndex] * 期权倍数;
                buyCount = +(buyCash / optionStartPrice).toFixed(2); //精确张数 允许小数测试
                if (buyCount > 1) buyCount = Math.ceil(buyCash / optionStartPrice); //向xia取整
                buyCash = buyCount * optionStartPrice + buyCount * 单张费用;//包含手续费
                总费用 = 总费用 + buyCount * 单张费用
            }

            if (asset.现金 < buyCash) {
                curBuy入金 = buyCash - asset.现金;
            }

            return [buyCash, curBuy入金, buyCount];
        }
        function get持仓日数(curSell) {
            let startDate = curSell[buyDateIndex].substring(0, 10);
            let startIndex = 沪深300ETF.findIndex((e) => e.date == startDate);
            let endDate = extractDate(curSell[sellDateIndex]);
            let endIndex = 沪深300ETF.findIndex((e) => e.date == endDate);
            return endIndex - startIndex;
        }
        function getCurDate区间类型(curDate) {
            let curDate日期区间 = ""
            Object.keys(triggerLogObj区间.上升日期区间).forEach(key => {
                let dateRange = key.split("=>");
                let startDate = dateRange[0];
                let endDate = dateRange[1];
                if (startDate <= curDate && curDate <= endDate) {
                    curDate日期区间 = "上升日期区间"
                    return
                }
            });
            Object.keys(triggerLogObj区间.下降日期区间).forEach(key => {
                let dateRange = key.split("=>");
                let startDate = dateRange[0];
                let endDate = dateRange[1];
                if (startDate <= curDate && curDate <= endDate) {
                    curDate日期区间 = "下降日期区间"
                    return false;
                }
            });
            return curDate日期区间
        }
        function getKeyId(期权arr) {
            return 期权arr[0] + "," + 期权arr[1] + "," + 期权arr[2];
        }
        function extr张数(str) {
            // 1. 以"张"分割，取其前部分（确保"张"存在）
            const prefix = str.split('张')[0];
            if (!prefix) return NaN;

            // 2. 从分割结果末尾匹配连续的数字/小数点（自动跳过末尾空格等非数字字符）
            const match = prefix.match(/[\d.]+$/);
            let res = match ? +match[0] : NaN;
            //console.log("extr张数:", str, "=>", res);
            return res;

        }
        function extractDate(str) {
            if (!str) return null;
            // 正则表达式匹配 YYYY-MM-DD 格式的日期
            const dateRegex = /\d{4}-\d{2}-\d{2}/;
            const match = str.match(dateRegex);

            if (match) {
                return match[0];
                // 验证日期是否有效
                //const date = new Date(match[0]);
                //if (date instanceof Date && !isNaN(date)) {
                //    return match[0]; // 返回匹配到的日期字符串
                //}
            }

            return null; // 如果没有找到有效日期，返回null
        }
        function preNext交易日(curDate, preNext = -1) {
            if (preNext === 0) return curDate;
            let curDateIndex = 沪深300.findIndex(e => e.date == curDate)
            if (curDateIndex > -1 && curDateIndex + preNext <= 沪深300.length - 1)
                return 沪深300[curDateIndex + preNext].date
            else {
                let resDate = stampToDate(dateToStamp(curDate) + preNext * 86400000)
                while (
                    new Date(resDate).getDay() == 0 ||
                    new Date(resDate).getDay() == 6 ||
                    (resDate <= 沪深300.at(-1).date && !沪深300.find(e => e.date == resDate))
                ) {
                    preNext > 0 ? resDate = stampToDate(dateToStamp(resDate) + 86400000) : resDate = stampToDate(dateToStamp(resDate) - 86400000)
                }
                return resDate;
            }
        }
        function check沽提前卖出(curDate, asset期权, trigBuy) {

            let 沪深300技术 = {};
            沪深300技术.dayDatas = 沪深300;
            沪深300技术 = calDayWeekMonthKline(沪深300技术, curDate);

            let pre1Week = 沪深300技术.currentWeekList.at(-2);
            let curWeek = 沪深300技术.currentWeekList.at(-1);

            let pre3Day = 沪深300技术.currentDayList.at(-4);
            let pre2Day = 沪深300技术.currentDayList.at(-3);
            let pre1Day = 沪深300技术.currentDayList.at(-2);
            let curDay = 沪深300技术.currentDayList.at(-1);

            function KDJ死叉(periodList, N = 2, tweaks = 0) {
                for (let index = 1; index <= N; index++) {
                    let pre2Period = periodList[periodList.length - (index + 2)]
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    let res = (pre1Period.K > pre1Period.D) && (currentPeriod.K <= currentPeriod.D + tweaks)
                        && pre1Period.J > currentPeriod.J
                    if (res) return true
                }
                return false
            }
            function MACD死叉(periodList, N = 2) {
                for (let index = 1; index <= N; index++) {
                    let pre2Period = periodList[periodList.length - (index + 2)]
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    let res = pre1Period.bar > 0 && currentPeriod.bar <= 0
                    if (res) return true
                }
                return false
            }
            function ocHighest(period) {
                return period.open > period.close ? period.open : period.close
            }
            function ocLowest(period) {
                return period.open < period.close ? period.open : period.close
            }
            function countWeekdays(startDateStr, endDateStr) {
                /**
                * 计算两个日期之间（包含两端）非周六、周日的天数
                * @param {string} startDateStr - 开始日期，格式 'YYYY-MM-DD'
                * @param {string} endDateStr - 结束日期，格式 'YYYY-MM-DD'
                * @returns {number} 工作日天数（周一至周五）
                */
                // 安全解析日期字符串为 UTC 日期对象
                const parseUTCDate = (str) => {
                    const [year, month, day] = str.split('-').map(Number);
                    const date = new Date(Date.UTC(year, month - 1, day));
                    if (isNaN(date.getTime())) {
                        throw new Error(`无效日期: ${str}`);
                    }
                    return date;
                };

                try {
                    const start = parseUTCDate(startDateStr);
                    const end = parseUTCDate(endDateStr);

                    // 处理开始日期晚于结束日期的情况
                    if (start > end) return 0;

                    // 计算总天数（包含两端）
                    const totalDays = Math.floor((end - start) / (24 * 60 * 60 * 1000)) + 1;

                    // 获取开始日期的星期（UTC时间，0=周日，6=周六）
                    const startDay = start.getUTCDay();

                    // 计算完整周数和剩余天数
                    const fullWeeks = Math.floor(totalDays / 7);
                    const remainingDays = totalDays % 7;

                    // 计算完整周贡献的周末天数
                    let weekendDays = fullWeeks * 2;

                    // 计算剩余天数中的周末天数
                    for (let i = 0; i < remainingDays; i++) {
                        const currentDay = (startDay + i) % 7;
                        if (currentDay === 0 || currentDay === 6) { // 周日或周六
                            weekendDays++;
                        }
                    }

                    // 工作日 = 总天数 - 周末天数
                    return totalDays - weekendDays;
                } catch (error) {
                    console.error('日期处理错误:', error.message);
                    return 0; // 发生错误时返回0
                }
            }
            function extractFirstNumber(str) {
                // 使用正则表达式匹配第一个数字（包括小数）
                const match = str.match(/^-?\d+(?:\.\d+)?/);
                return match ? parseFloat(match[0]) : null;
            }
            function 绿绿(periodList, N = 1) {
                for (let index = 1; index <= N; index++) {
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    if (
                        true
                        && curtPercent(pre1Period) < 0
                        && curtPercent(currentPeriod) < 0
                    ) {
                        return true
                    }
                }
                return false
            }
            function 绿空绿(periodList, N = 1) {
                for (let index = 1; index <= N; index++) {
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    if (
                        true
                        && curtPercent(pre1Period) < 0
                        && (pre1Period.close > currentPeriod.open)
                        && curtPercent(currentPeriod) < 0
                    ) {
                        return true
                    }
                }
                return false
            }
            function 绿空红(periodList, N = 1) {
                for (let index = 1; index <= N; index++) {
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    if (
                        true
                        && curtPercent(pre1Period) <= 0
                        && (pre1Period.close > currentPeriod.close)
                        && curtPercent(currentPeriod) > 0
                    ) {
                        return true
                    }
                }

                return false
            }
            function 绿空绿红(periodList, N = 1) {
                for (let index = 1; index <= N; index++) {
                    let pre2Period = periodList[periodList.length - (index + 2)]
                    let pre1Period = periodList[periodList.length - (index + 1)]
                    let currentPeriod = periodList[periodList.length - index]
                    if (
                        true
                        && curtPercent(pre2Period) <= 0
                        && (pre2Period.close > pre1Period.open)
                        && curtPercent(pre1Period) <= 0
                        && curtPercent(currentPeriod) >= 0
                    ) {
                        return true
                    }
                }

                return false
            }

            let res = ""

            function ths反向() {
                // return false //暂时关闭同花顺反向指标
                for (let i = 0; i < 技术指标统计.length; i++) {
                    let ti = 技术指标统计[i];
                    if (ti[0] == getDateInWeekDay(curDate) && asset期权[0] <= ti[0] && ti[0] < asset期权[1]) return true;
                }
                for (let i = 0; i < 小市值低估.length; i++) {
                    let ti = 小市值低估[i];
                    if (ti[3] == curDate && asset期权[0] <= ti[3] && ti[3] < asset期权[1]) return true;
                }
            }
            if (ths反向()) res += "P0"

            function 区间反向() {
                // return false //todo!!!!
                // let pmiValue
                // if (cn_pmi_平均.at(-1)[0].substring(0, 7) == curDate.substring(0, 7)) pmiValue = cn_pmi_平均.at(-1)
                // else pmiValue = cn_pmi_平均.find(e => e[0].substring(0, 7) == getPreMonth(curDate).substring(0, 7))
                // pmiValue[1] <= -9.5
                let curDate日期区间 = getCurDate区间类型(curDate)
                if (
                    curDate日期区间 == "上升日期区间" &&
                    (
                        (curDay.close < curDay.lows && curWeek.close < curWeek.mas && curWeek.J < 20 && pre1Week.close > pre1Week.mas) ||
                        (ocHighest(curDay) < curDay.lows && curDay.J < 0 && curWeek.low < curWeek.mas && curtPercent(curWeek) < 0 && curWeek.J < 0 && curWeek.bar < 0) //2025-11-24
                    ) &&
                    !(
                        KDJ死叉(沪深300技术.currentDayList) &&
                        MACD死叉(沪深300技术.currentDayList)
                    ) &&
                    !(
                        KDJ死叉(沪深300技术.currentDayList) &&
                        MACD死叉(沪深300技术.currentDayList)
                    )
                ) return true
            }
            if (区间反向()) res += "P1"


            if (
                绿绿(沪深300技术.currentDayList) &&
                ocLowest(curDay) < curDay.lows &&
                (
                    (curDay.bias.bias3 < -8 && pre1Day.bias.bias3 >= curDay.bias.bias3) ||
                    (pre1Day.bias.bias3 - curDay.bias.bias3 > 4)
                )
            ) res += 'P2'   //` ${curDay.date}绿绿` //2022-03-18 极低


            if (
                asset期权[buyPriceIndex] / extractFirstNumber(asset期权[3]) > 0.05 &&
                curtPercent(curDay) < 0 &&
                (curDay.J < 0 || 绿空绿(沪深300技术.currentDayList)) &&
                (curDay.bias.bias1 < 0 || curDay.bias.bias2 < 0) &&
                pre1Day.mas < curDay.mas &&
                沪深300技术.currentWeekList.at(-2).D < 沪深300技术.currentWeekList.at(-1).D &&
                沪深300技术.currentMonthList.at(-2).D < 沪深300技术.currentMonthList.at(-1).D
            ) res += 'P3'   //` ${curDay.date}波动率太贵绿` //2024-11-15 低位太贵


            if (
                绿空绿红(沪深300技术.currentDayList) &&
                (pre1Day.high < pre1Day.lows || curDay.high < curDay.lows) &&
                curDay.bias.bias3 < -3 &&
                curDay.J < 10 && pre1Day.J < curDay.J
            ) res += 'P4'   //` ${curDay.date}绿空绿红` //2021-08-20  低位可能转向

            if (
                绿空绿(沪深300技术.currentDayList) &&
                33 > curDay.D && curDay.D > curDay.J &&
                curDay.bias.bias3 < -3 &&
                0 > curDay.bias.bias1 && curDay.bias.bias1 > curDay.bias.bias2 && curDay.bias.bias2 > curDay.bias.bias3 &&
                !(
                    KDJ死叉(沪深300技术.currentDayList) &&
                    MACD死叉(沪深300技术.currentDayList)
                ) &&
                !(
                    KDJ死叉(沪深300技术.currentWeekList, 2) &&
                    MACD死叉(沪深300技术.currentWeekList, 1)
                ) &&
                1 < countWeekdays(curDay.date, asset期权[1]) &&
                countWeekdays(curDay.date, asset期权[1]) < 7
            ) res += 'P5'   //` ${curDay.date}绿空绿7` //2022-01-21  2022-02-18  低位快到期

            return res;
        }
        function check提前卖出(curDate, asset期权, trigBuy) {
            let res = ""
            if (
                trigBuy
                && (
                    ((trigBuy[2].includes("高") || trigBuy[2].includes("↓")) && (asset期权[2].includes("低") || asset期权[2].includes("↑"))) ||
                    ((trigBuy[2].includes("低") || trigBuy[2].includes("↑")) && (asset期权[2].includes("高") || asset期权[2].includes("↓")))
                ) && dateToStamp(trigBuy[0]) < dateToStamp(asset期权[1])
            ) {
                res += "A" //反向
            }

            if (asset期权[3].includes("沽")) {
                res += check沽提前卖出(curDate, asset期权, trigBuy)
            }

            if (res != "") return res
            return false
        }

        async function 模拟交易() {
            for (let i = startOldestIndex; i < 沪深300.length; i++) {
                let curDate = 沪深300[i].date;
                let curDateHasConsole = false;

                //当日收盘触发下日买入,写入下个交易日买入日期.
                let curTrigBuy = 期权买卖List.find((e) => e[0] == curDate && !arrayHasIndex(e, buyDateIndex));
                if (curTrigBuy) {
                    if (!curTrigBuy[3].includes("手动") && !curTrigBuy[3].includes("模拟")) {
                        let [buyCash, curbuy入金, buyCount] = getBuyCashAnd入金(curTrigBuy, "预估ETF");
                        let msg = `${curDate} 触发收盘通知下个交易日${preNext交易日(curDate, 1)}开盘买入 [${getKeyId(curTrigBuy)}] 预估买ETF期权${buyCash}`
                        console.log(msg);
                        curDateHasConsole = true;
                        if (isSendMail(curDate)) pageSendMail(msg)
                    }
                    if (curTrigBuy[3].includes("手动")) { };
                    if (curTrigBuy[3].includes("模拟")) curTrigBuy[buyDateIndex] = preNext交易日(curDate, 1);
                }

                //当日收盘触发下日卖出,写入下个交易日卖出日期.
                for (let index = asset.期权.length - 1; index >= 0; index--) {
                    let asset期权 = asset.期权[index];
                    if (!arrayHasIndex(asset期权, buyDateIndex)) continue;
                    if (arrayHasIndex(asset期权, sellDateIndex)) continue;

                    let curNextOne交易日 = preNext交易日(curDate, 1)
                    let sellDateStr
                    let need提前卖出 = check提前卖出(curDate, asset期权, curTrigBuy);
                    if (need提前卖出)
                        sellDateStr = `提前${need提前卖出}:${curNextOne交易日}`;
                    else if (curNextOne交易日 == preNext交易日(asset期权[1], 默认卖出到期类型))
                        sellDateStr = `${curNextOne交易日}`;

                    if (!sellDateStr) continue

                    if (asset期权[3].includes("手动")) {
                        let msg = `${curDate} 触发收盘通知下个交易日${sellDateStr}卖出[${getKeyId(asset期权)}]`
                        console.log(curDateHasConsole ? msg.substring(11).leftAppend() : msg);
                        curDateHasConsole = true;
                        if (isSendMail(curDate)) pageSendMail(msg)
                    };
                    if (asset期权[3].includes("模拟")) asset期权[sellDateIndex] = sellDateStr;
                }

                //当日卖出
                let curAllSell入金;
                let curAllSellCash;
                let curAllSellCount = 0;
                let curAllNeed入金Count = 0;
                let 模拟or手动 = "模拟"
                for (let index = asset.期权.length - 1; index >= 0; index--) {
                    let asset期权 = asset.期权[index];
                    if (curDate !== extractDate(asset期权[sellDateIndex])) { continue; }

                    let 单张费用 = asset期权[3].includes("ETF") ? etf费用 : 指数费用
                    let 期权倍数 = asset期权[3].includes("ETF") ? etf倍数 : 指数倍数
                    let 张数 = extr张数(asset期权[4]);

                    if (asset期权[3].includes("手动")) {
                        let sellDate = extractDate(asset期权[sellDateIndex]);
                        let sellPrice = asset期权[sellPriceIndex];
                        let sellCash = asset期权[sellCashIndex];

                        let curSell入金;
                        if (sellCash < 0 && asset.现金 + sellCash < 0) {
                            curSell入金 = 0 - (asset.现金 + sellCash);
                            总入金 = 总入金 + curSell入金;
                            curAllSell入金 = curSell入金 + (curAllSell入金 ?? 0);
                            asset.现金 = asset.现金 + curSell入金;
                            need入金[asset期权[0] + " " + asset期权[1] + " sell "] = curSell入金;
                            curAllNeed入金Count++;
                        }
                        总费用 = 总费用 + 张数 * 单张费用;

                        curAllSellCash = sellCash + (curAllSellCash ?? 0);
                        curAllSellCount++;

                        asset期权[4] = asset期权[4] + ":" + get持仓日数(asset期权) + "日" + (curSell入金 > 0 ? ":入金卖" : ""); //

                        asset.现金 = asset.现金 + sellCash;
                        asset.现金 = +asset.现金.toFixed(2);

                        模拟or手动 = "手动"
                        continue
                    }

                    if (arrayHasIndex(asset期权, sellPriceIndex)) { continue; }
                    if (arrayHasIndex(asset期权, sellCashIndex)) { continue; }
                    if (!liveServerOk) { continue; }
                    let excelFileName = asset期权[4].includes(".xlsx") ? asset期权[4] : asset期权[4].split(":")[0] + ".xlsx";
                    let excelFileData = await readExcel(excelFileName);
                    if (!excelFileData) { console.error(`模拟卖出${excelFileName}文件缺失`); continue }
                    let excelSellDateIndex = excelFileData.findIndex((e) => e.交易时间 == extractDate(asset期权[sellDateIndex]));
                    if (excelSellDateIndex == -1) excelSellDateIndex = excelFileData.length - 1;
                    let sellDate = excelFileData[excelSellDateIndex].交易时间;
                    let 卖出开or收 = asset期权[sellDateIndex].includes("提前") ? "开盘价" : 默认卖出开or收;
                    let sellPrice = excelFileData[excelSellDateIndex][卖出开or收];

                    let buyPrice = asset期权[buyPriceIndex];
                    let priceProfile = +((sellPrice - buyPrice) / buyPrice).toFixed(2);
                    if (priceProfile <= 0 && asset期权[sellDateIndex].includes("提前")) { asset期权[sellDateIndex] = null; continue; }

                    if (!asset期权[sellDateIndex].includes(sellDate)) asset期权[sellDateIndex] = sellDate;
                    asset期权[sellDateIndex] += 卖出开or收.substring(0, 1)
                    asset期权[sellPriceIndex] = +sellPrice.toFixed(2);
                    asset期权[profileIndex] = +priceProfile.toFixed(2);

                    if (模拟盈亏) {
                        priceProfile = gerRandomProfile(priceProfile)
                        sellPrice = buyPrice * (1 + priceProfile)
                        asset期权[sellPriceIndex] = +sellPrice.toFixed(2);
                        asset期权[profileIndex] = +priceProfile.toFixed(2);
                    }

                    let sellCash = (asset期权[buyCashIndex] - 张数 * 单张费用) * (1 + priceProfile);
                    sellCash = sellCash - 张数 * 单张费用;

                    curAllSellCash = sellCash + (curAllSellCash ?? 0);
                    总sellCash += sellCash;
                    总费用 = 总费用 + 张数 * 单张费用;

                    let curSell入金;
                    if (sellCash < 0 && asset.现金 + sellCash < 0) {
                        curSell入金 = 0 - (asset.现金 + sellCash);
                        总入金 = 总入金 + curSell入金;
                        curAllSell入金 = curSell入金 + (curAllSell入金 ?? 0);
                        asset.现金 = asset.现金 + curSell入金;
                        need入金[asset期权[0] + " " + asset期权[1] + " sell "] = curSell入金;
                        curAllNeed入金Count++;
                    }

                    sellCash = +sellCash.toFixed(2)
                    asset期权[sellCashIndex] = sellCash;
                    asset期权[4] = asset期权[4] + ":" + get持仓日数(asset期权) + "日" + (curSell入金 > 0 ? ":入金卖" : ""); //

                    ////从后往前所以可以删除而不影响索引！！！！！！
                    //asset.期权 = asset.期权.filter((item) => getKeyId(item) != getKeyId(asset期权))
                    asset.现金 = asset.现金 + sellCash;
                    asset.现金 = +asset.现金.toFixed(2);
                    curAllSellCount++;
                }
                if (isNumber(curAllSellCash)) {
                    if (curAllSell入金 > 0) {
                        curAllSell入金 = +curAllSell入金.toFixed(2)
                        console.log(curDateHasConsole ? "补足卖手续费入金".leftAppend() + curAllNeed入金Count : `${curDate} 补足卖手续费入金${curAllNeed入金Count}`, curAllSell入金, "=>", cloneAsset(asset));
                        curDateHasConsole = true;
                    }
                    curAllSellCash = +curAllSellCash.toFixed(2)
                    console.log(curDateHasConsole ? `${模拟or手动}卖出`.leftAppend() + curAllSellCount : `${curDate} ${模拟or手动}卖出` + curAllSellCount, curAllSellCash, "=>", cloneAsset(asset));
                    curDateHasConsole = true;
                }

                //当日买入
                let curBuy = 期权买卖List.find((e) => e[buyDateIndex] == curDate);
                if (curBuy) {
                    let 单张费用 = curBuy[3].includes("ETF") ? etf费用 : 指数费用
                    let 期权倍数 = curBuy[3].includes("ETF") ? etf倍数 : 指数倍数
                    if (curBuy[3].includes("手动")) {
                        let buyPrice = curBuy[buyPriceIndex];
                        let buyCash = curBuy[buyCashIndex];
                        if (asset.现金 < buyCash) {
                            let curbuy入金 = buyCash - asset.现金
                            总入金 = 总入金 + curbuy入金;
                            asset.现金 = asset.现金 + curbuy入金;
                            need入金[curBuy[0] + " " + curBuy[1] + " buy"] = curbuy入金;
                            console.log(curDateHasConsole ? "手动补足买入金".leftAppend() : `${curDate} 手动补足买入金 `, curbuy入金, "=>", cloneAsset(asset));
                            curDateHasConsole = true;
                        }
                        let 张数 = extr张数(curBuy[4]);
                        总费用 = 总费用 + 张数 * 单张费用;

                        总buyCash = 总buyCash + buyCash
                        asset.现金 = asset.现金 - buyCash;
                        asset.现金 = +asset.现金.toFixed(2);
                        asset.期权.unshift(curBuy);

                        console.log(curDateHasConsole ? "手动买入 ".leftAppend() : `${curDate} 手动买入 `, buyCash, "=>", cloneAsset(asset));
                        curDateHasConsole = true;
                    }
                    if (curBuy[3].includes("模拟") && !arrayHasIndex(curBuy, sellPriceIndex) && liveServerOk) {
                        let excelFileName = curBuy[4].includes(".xlsx") ? curBuy[4] : curBuy[4].split(":")[0] + ".xlsx";
                        let excelFileData = await readExcel(excelFileName);
                        if (!excelFileData) { console.error(`模拟买入${excelFileName}文件缺失`); continue }
                        let excelBuyDateIndex = excelFileData.findIndex((e) => e.交易时间 == curBuy[buyDateIndex]);
                        if (excelBuyDateIndex == -1) excelBuyDateIndex = 0;
                        let buyDate = excelFileData[excelBuyDateIndex].交易时间;
                        let buyPrice = excelFileData[excelBuyDateIndex]["开盘价"];
                        curBuy[buyDateIndex] = buyDate;
                        curBuy[buyPriceIndex] = buyPrice;

                        let [buyCash, curbuy入金, buyCount] = getBuyCashAnd入金(curBuy);
                        if (curbuy入金 > 0) {
                            总入金 = 总入金 + curbuy入金;
                            asset.现金 = asset.现金 + curbuy入金;
                            need入金[curBuy[0] + " " + curBuy[1] + " buy"] = curbuy入金;
                            console.log(curDateHasConsole ? "补足买入金".leftAppend() : `${curDate} 补足买入金 `, curbuy入金, "=>", cloneAsset(asset));
                            curDateHasConsole = true;
                        }

                        总buyCash = 总buyCash + buyCash
                        buyCash = +buyCash.toFixed(2)
                        curBuy[buyCashIndex] = buyCash;
                        curBuy[4] = curBuy[4].replace(".xlsx", "") + (curbuy入金 > 0 ? ":入金买" : "") + ":" + buyCount + "张"; //购买张数

                        asset.现金 = asset.现金 - buyCash;
                        asset.现金 = +asset.现金.toFixed(2);
                        asset.期权.unshift(curBuy);

                        console.log(curDateHasConsole ? "模拟买入 ".leftAppend() : `${curDate} 模拟买入 `, buyCash, "=>", cloneAsset(asset));
                        curDateHasConsole = true;
                    }
                }
            }
        }

        (async () => {
            if (期权买卖List.length == 0) return
            console.groupCollapsed("模拟真实");
            if (liveServerOk) await fetch(liveServerUrl).catch(err => { liveServerOk = false })


            await 模拟交易();

            console.log("")
            console.log(`模拟真实${单次最小投资}到${单次最大投资}: `, "总入金:", +总入金.toFixed(2), "总buyCash:", +总buyCash.toFixed(2), "总sellCash:", +总sellCash.toFixed(2), "asset现金:", +asset.现金.toFixed(2), "总入金收益率:", +(((asset.现金 - 总入金) / 总入金) * 100).toFixed(4) + "%", "总buyCash收益率:", +(((asset.现金 - 总buyCash) / 总buyCash) * 100).toFixed(4) + "%");

            let test总buyCash = 0;
            let test总sellCash = 0;
            asset.期权.forEach((ele) => {
                test总buyCash += ele[buyCashIndex];
                test总sellCash = test总sellCash + (ele[sellCashIndex] ?? 0)
            });
            console.log("总buyCash", +test总buyCash.toFixed(2), "总sellCash", +test总sellCash.toFixed(2), "总sellCash-总sellCash+总入金", +(test总sellCash - test总buyCash + 总入金).toFixed(2));

            let need入金统计 = need入金groupByYear(need入金)
            if (need入金统计[currentDayYMD.substring(0, 4)]?.sum > 31000) pageSendMail(currentDayYMD.substring(0, 4) + "年入金已超30000")
            console.log("总费用", 总费用, "need入金统计", need入金统计);

            const endJs = performance.now();
            if (!devTestEnv) pageSendMail("cn-option-模拟交易完成测试：" + getDateTime() + `代码运行时间: ${(endJs - startJs).toFixed(2)} 毫秒 ${devTestEnv}` + "  asset现金:" + +asset.现金.toFixed(2));
            console.groupEnd();

            let profileArr = []
            asset.期权 = asset.期权.map(ele => {
                ele[3] = ele[3].replace("沪深300", "300")
                ele[4] = ele[4].substring(7)
                profileArr.push(ele[profileIndex])
                return ele
            })
            let 购期权 = asset.期权.filter((ele, index) => {
                return ele[3].includes("购");
            });
            购期权.sort((a, b) => b[profileIndex] - a[profileIndex]);
            console.log(购期权);

            let 沽期权 = asset.期权.filter((ele, index) => {
                return ele[3].includes("沽");
            });
            沽期权.sort((a, b) => b[profileIndex] - a[profileIndex]);
            console.log(沽期权);

            asset.期权.sort((a, b) => b[profileIndex] - a[profileIndex]);
            console.log(asset.期权, profileArr);

        })();

    </script>

</head>

<body style="height: 100%; width: 100%; margin: 0">
    <div id="container" style="height: 100%; width: 100%;"></div>
    <script type="text/javascript">
        Array.prototype.addStartEnd = function () {
            let arr = this
            let startYear = 2000
            if (arr.length > 0 && Date.parse(arr[0][0]) < Date.parse(`${startYear}-01-01`))
                arr = arr.filter(item => {
                    return parseFloat(item[0].substring(0, 4)) >= startYear
                })


            arr = [
                [`${startYear}-01-01`, ""]
            ].concat(arr)

            let last300Day = 沪深300[沪深300.length - 1].date
            if (+last300Day.substring(5, 7) <= 7)
                var chartLastDay = last300Day.substring(0, 4) + "-12-28"
            else
                var chartLastDay = +last300Day.substring(0, 4) + 1 + "-12-28"

            arr.push([chartLastDay, ""])

            return arr
        }

        var dom = document.getElementById("container");
        var myChart = echarts.init(dom, "red", {
            renderer: "canvas",
            useDirtyRect: false,
        });
        var app = {};
        var option;

        let gridbackgroundColor = "#f7f9fa"
        let splitLineColor = "#d8d8d8"
        let grid默认 = [
            { //ppi
                left: 60,
                right: 80,
                top: "0%",
                height: '17%',
                show: true,

            },

            { //利润亏损
                left: 60,
                right: 80,
                top: "17%",
                height: '18%',
                show: true,

            },

            { //股债  
                left: 60,
                right: 80,
                top: "35%",
                height: '23%',
                show: true,
            },
            { //策略 
                left: 60,
                right: 80,
                top: "35%",
                height: '23%', // 23 or 43  
                show: true,
            },
            { //隐藏
                left: 60,
                right: 80,
                top: "58%",
                height: '20%',
                show: true,
            },
            { //指数
                left: 60,
                right: 80,
                top: "35%",
                height: '43%', // 23 or 43  
                show: true,
            },


            { //PMI
                left: 60,
                right: 80,
                top: "58%",
                height: '20%',
                show: true,
            },

            { //M12 信贷
                left: 60,
                right: 80,
                top: "78%",
                height: '20%',
                show: true,
                //backgroundColor: gridbackgroundColor,
            },
        ]
        let grid全屏 = [
            { //ppi
                left: 60,
                right: 80,
                top: "0%",
                height: '17%',
                show: true,

            },

            { //利润亏损
                left: 60,
                right: 80,
                top: "17%",
                height: '18%',
                show: true,

            },

            { //股债  
                left: 60,
                right: 80,
                top: "35%",
                height: '15%',
                show: true,
            },
            { //策略 
                left: 60,
                right: 80,
                top: "35%",
                height: '15%', // 23 or 43  
                show: true,
            },
            { //隐藏
                left: 60,
                right: 80,
                top: "50%",
                height: '13%',
                show: true,
            },
            { //指数
                left: 60,
                right: 80,
                top: "35%",
                height: '28%', // 23 or 43  
                show: true,
            },


            { //PMI
                left: 60,
                right: 80,
                top: "63%",
                height: '17%',
                show: true,
            },

            { //M12 信贷
                left: 60,
                right: 80,
                top: "80%",
                height: '18%',
                show: true,
                //backgroundColor: gridbackgroundColor,  98
            },
        ]

        option = {
            title: {},
            tooltip: {
                trigger: "axis",
                show: true,
                position: ["3%", "23.5%"],
                order: "seriesDesc",
                formatter: function (params, ticket, callback) {
                    return null;
                },
                axisPointer: {
                    type: "cross",
                    show: true,
                    crossStyle: {
                        width: 0.6,
                        color: "black", // 鼠标十字横轴
                    },
                },
            },
            legend: {
                inactiveColor: '#9a9393',
                left: "0.5%",
                top: "-0.5%"

            },
            axisPointer: {
                type: "cross",
                show: true,
                link: [{
                    xAxisIndex: "all",
                },],
                lineStyle: {
                    color: "black", // 鼠标十字竖轴
                    lineStyle: {
                        width: 0.6,
                        color: "black", // 鼠标十字竖轴
                    },
                },
            },
            dataZoom: [

                {
                    show: true,
                    realtime: true,
                    start: 0,
                    end: 100,
                    xAxisIndex: [0, 1, 2, 3, 4, 5, 6, 7],
                    bottom: -15,
                },
            ],

            grid: grid默认,

            xAxis: [

                { //ppi
                    gridIndex: 0,
                    type: "time",
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: true,
                        },
                    },
                    axisLabel: {
                        fontSize: 10,
                        formatter: "{yyyy}",
                        padding: [0, -50, 0, 0],
                    },
                },

                { //利润亏损
                    gridIndex: 1,
                    type: "time",
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },

                { //股债  
                    gridIndex: 2,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true, // 抓数据圆圈
                        label: {
                            show: false, //黑框日期
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },
                { //策略
                    gridIndex: 3,
                    type: "time",
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },
                { //隐藏
                    gridIndex: 4,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },
                { //指数  
                    gridIndex: 5,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true, // 抓数据圆圈
                        label: {
                            show: true, //黑框日期  显示指数日期
                        },
                    },
                    axisLabel: {
                        show: false
                    }

                },

                { //PMI
                    gridIndex: 6,
                    type: "time",
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },

                { //M12 信贷
                    gridIndex: 7,
                    type: "time",
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },

            ],

            yAxis: [

                { //ppi
                    gridIndex: 0,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value <= -10) return ""
                            else return value
                        }
                    },
                    position: "right",
                },
                {
                    gridIndex: 0,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "left",
                    max: 115,
                    min: 90
                },

                { //利润亏损
                    gridIndex: 1,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 60 || value < -20) return ""
                            else return value
                        }
                    },
                    position: "right",
                    max: 65,
                    min: -35
                },
                {
                    gridIndex: 1,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "left",
                },

                { //股债  
                    gridIndex: 2,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "right",
                    inverse: true, //默认现实平均
                    interval: 3,
                    max: 8.5,
                    min: 0,
                },
                {
                    gridIndex: 2,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 700) return value / 1000 + "K"
                            else return value
                        }
                    },
                    position: "left",
                    min: 700
                },
                { //策略
                    gridIndex: 3,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },
                    max: 20,
                    position: "right",
                },
                {
                    gridIndex: 3,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "left",
                },
                { //隐藏 
                    gridIndex: 4,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    // interval: 5,
                    // max: 50,
                    // min: -25,
                    // position: "right",
                },
                {
                    gridIndex: 4,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "left",
                },
                { //指数
                    gridIndex: 5,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 700) return value / 1000 + "K"
                            else return value
                        }
                    },
                    position: "left",
                    min: 700
                },
                {
                    gridIndex: 5,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "right",
                },

                { //PMI 
                    gridIndex: 6,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if ([-10, 10].includes(value)) return value
                            else return ""
                        }
                    },
                    interval: 5,
                    max: 50,
                    min: -25,
                    position: "right",
                },
                {
                    gridIndex: 6,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    position: "left",
                },

                { //信贷 右侧列数据
                    gridIndex: 7,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value >= 40) return ""
                            else return value
                        }
                    },
                    position: "right",
                    max: 40,
                    min: 20,
                },
                { //M1_M2  金融脉动us  美元指数 左侧列数据 
                    gridIndex: 7,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    interval: 10,
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 30) return ""
                            else return value
                        },
                        color: "black"
                    },
                    position: "left",
                    max: 25,
                    min: -20
                },

            ],

            series: [

                { //ppi
                    name: "ppi同比",
                    type: "line",
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.5,
                    },
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.95,
                                    color: "#0079cd" //"#0081B6",
                                },

                                {
                                    offset: 0.25,
                                    color: "#FD4142" //"#FD4142",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "#ff535c",
                            },
                            label: {
                                formatter: "上下穿5",
                                color: "#ff535c",
                                fontSize: 10,
                                position: "insideStartTop",
                            },
                            yAxis: 5, // 标线值
                        },

                        {
                            lineStyle: {
                                width: 0.5,
                                color: "black",
                            },
                            label: {
                                formatter: "0",
                                color: "#0081B6",
                                fontSize: 10,
                                position: "insideStartBottom",
                            },
                            yAxis: 0, // 标线值
                        },
                        ],
                    },
                    tooltip: {
                        show: true,
                    },
                    data: PPI.addStartEnd(),
                },
                {
                    name: "ppi基数",
                    type: "line",
                    xAxisIndex: 0,
                    yAxisIndex: 1,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        //color: "red",
                        width: 1.2,
                    },
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.95,
                                    color: "#0079cd" //"#0081B6",
                                },

                                {
                                    offset: 0.25,
                                    color: "#FD4142" //"#FD4142",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },
                    data: PPI_eastmoney.map((ele, index) => {
                        return [
                            ele.REPORT_DATE.substring(0, 8) + "28",
                            ele.BASE
                        ]
                    }).addStartEnd()
                },
                {
                    name: "ppi基数",
                    type: "line",
                    xAxisIndex: 0,
                    yAxisIndex: 1,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        type: "dotted",
                        color: "black",//
                        width: 1,
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "#ff535c",
                            },
                            label: {
                                formatter: "上下穿5",
                                color: "#ff535c",
                                fontSize: 10,
                                position: "insideStartTop",
                            },
                            yAxis: 105, // 标线值
                        },

                        {
                            lineStyle: {
                                width: 0.5,
                                color: "black",
                            },
                            label: {
                                formatter: "0",
                                color: "#0081B6",
                                fontSize: 10,
                                position: "insideStartBottom",
                            },
                            yAxis: 100, // 标线值
                        },
                        ],
                    },
                    data: PPI_eastmoney.map((ele, index) => {
                        return [
                            ele.REPORT_DATE.substring(0, 8) + "28",
                            ele.BASE_ACCUMULATE
                        ]
                    }).addStartEnd()
                },


                { //利润亏损
                    name: '红利$蓝亏',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 2,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "#FD4142", //"#fd76c8"
                    },
                    data: 利润同比.addStartEnd()
                },
                {
                    name: '红利$蓝亏',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 2,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "#0081B6", //"#007c71",
                    },
                    data: 亏损增减.addStartEnd()
                },


                { //股债
                    name: "股债差",
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    data: 股债差300平均.filter((item) => {
                        return parseFloat(item[0].substring(0, 4)) >= 2007;
                    }).addStartEnd(),
                    showSymbol: false,
                    lineStyle: {
                        width: 1.5,
                    },
                    zlevel: 1,
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.4,
                                    color: "red",
                                },
                                {
                                    offset: 0.6,
                                    color: "orange",
                                },

                                {
                                    offset: 0.8,
                                    color: "green",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "green",
                            },
                            label: {
                                formatter: "6低估",
                                fontSize: "10",
                                color: "green",
                                position: "start",
                            },
                            yAxis: 6, // 标线值
                            x: "6.5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "red",
                            },
                            label: {
                                formatter: "3高估",
                                fontSize: "10",
                                color: "red",
                                position: "start",
                            },
                            yAxis: 3, // 标线值
                            x: "6.5%",
                        },

                            // {
                            //     lineStyle: {
                            //         width: 0,
                            //         color: "#ff000000",
                            //         type: "solid" // 实线，不写默认虚线
                            //     },

                            //     yAxis: 0, // 标线值

                            // },
                        ],
                    },
                },
                {
                    name: '恒指美债差',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.7,
                        type: "dotted"
                    },
                    zlevel: 1,
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.4,   //小上移  大下移
                                    color: "red",
                                },
                                {
                                    offset: 0.5,
                                    color: "orange",
                                },

                                {
                                    offset: 0.7,
                                    color: "green",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },

                    data: 股债差恒指美债.filter((item) => {
                        return parseFloat(item[0].substring(0, 4)) >= 2007;
                    }).addStartEnd(),
                },

                {
                    name: "中位PE", //紫色 300PE中位数
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    data: 沪深300PE中位数.map(ele => {
                        return [ele[0], (1 / parseFloat(ele[1]) * 100).toFixed(2)]
                    }).addStartEnd(),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.1,
                        color: "#b749fd",
                    },
                    zlevel: 1,
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0,
                                color: "#ff535c",
                            },
                            label: {
                                position: "start",
                                formatter: "30PE高估",
                                fontSize: "10",
                                color: "#ff535c",
                            },
                            yAxis: 3.5,
                            x: "7.5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.7,
                                color: "green",
                            },
                            label: {
                                position: "start",
                                formatter: "20PE低估",
                                fontSize: "10",
                                color: "green",
                            },
                            yAxis: 5,
                            x: "7.5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.7,
                                color: "green",
                            },
                            label: {
                                position: "start",
                                formatter: "18PE低估",
                                fontSize: "10",
                                color: "green",
                            },
                            yAxis: 5.5,
                            x: "7.5%", //固定起点的 x 像素位置
                        },
                        ],
                    },
                },
                {
                    name: "中位PE", //紫色 沪深300PE中位数_lixinger
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    data: 沪深300PE中位数_lixinger.map(ele => {
                        return [ele[0], (1 / parseFloat(ele[1]) * 100).toFixed(2)]
                    }).addStartEnd(),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        type: "dotted",
                        width: 1,
                        color: "#b749fd",
                    },
                    zlevel: 1,
                },
                {
                    name: "中位PE", //橘色 全a剔除后中位
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    zlevel: 1,
                    data: 全A股PE中位数.map(ele => {
                        return [ele[0], (1 / parseFloat(ele[1]) * 100).toFixed(2)]
                    }).addStartEnd(),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.1,
                        color: "#ff814f",
                    },
                },
                {
                    name: "中位PE", //十年前国债收益率
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    zlevel: 1,
                    data: 十年期国债利率倒数.map(ele => {
                        return [ele[0], (1 / parseFloat(ele[1]) * 100).toFixed(2)]
                    }).addStartEnd(),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.1,
                        color: "black",
                    },
                },
                {
                    name: "美债", //美十年前国债收益率
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 4,
                    zlevel: 1,
                    data: Y10日.filter((ele, index, datasArr) => { //月最后一天
                        // var d = new Date(ele[0])
                        // var n = d.getDay()
                        // if(n==5) return true //周5
                        // if(datasArr.length-1 == index) return true
                        // return true
                        currentMonth = ele[0].substring(5, 7)
                        if (index < datasArr.length - 1) {
                            nextMonth = datasArr[index + 1][0].substring(5, 7)
                            return currentMonth != nextMonth
                        } else {
                            return true
                        }
                    })
                        .map(ele => {
                            return [ele[0], (parseFloat(ele[1])).toFixed(2)]
                        }).filter((item) => {
                            return parseFloat(item[0].substring(0, 4)) >= 2005;
                        }).addStartEnd(),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        type: 'dotted',
                        width: 1,
                        color: "black",
                    },
                },




                {//区间策略
                    name: '区间策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: "pin",// /symbol: 'path://M 200 200 l-40 100 100 -80 -120 0 100 80 -40 -120 -40 120z',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "red"
                        }
                    },
                    symbolSize: function (val) {
                        return 5
                    },
                    zlevel: 1,
                    data: 区间策略建议ByDay.filter((item) => {
                        return (item[2].includes("高") || item[2].includes("↓")) && item.tAr.includes("_")
                    }).map((item) => {
                        return [item[0], 19]
                    }).addStartEnd()
                },
                {
                    name: '区间策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: "pin",//'path://M 200 200 l-40 100 100 -80 -120 0 100 80 -40 -120 -40 120z',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "black"
                        }
                    },
                    symbolSize: function (val) {
                        return 5
                    },
                    zlevel: 1,
                    data: 区间策略建议ByDay.filter((item) => {
                        return (item[2].includes("低") || item[2].includes("↑")) && item.tAr.includes("_")
                    }).map((item) => {
                        return [item[0], 19]
                    }).addStartEnd()
                },



                {//大盘策略
                    name: '大盘策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: 'path://M 200 200 l-40 100 100 -80 -120 0 100 80 -40 -120 -40 120z',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "red"
                        }
                    },
                    symbolSize: function (val) {
                        return 7
                    },
                    zlevel: 3,
                    data: 指数策略高位ByDay.filter((item) => {
                        return item[3].includes("★")
                    }).map((item) => {
                        return [item[0], item[1].length, item[1]]
                    }).addStartEnd()
                },
                {
                    name: '大盘策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: "pin",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "red"
                        }
                    },
                    symbolSize: function (val) {
                        return 6
                    },
                    zlevel: 2,
                    data: 指数策略高位ByDay.filter((item) => {
                        return !item[3].includes("★")
                    }).map((item) => {
                        return [item[0], item[1].length, item[1]]
                    }).addStartEnd()
                },
                {
                    name: '大盘策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: 'path://M 200 200 l-40 100 100 -80 -120 0 100 80 -40 -120 -40 120z',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#003900"
                        }
                    },
                    symbolSize: function (val) {
                        return 7
                    },
                    zlevel: 3,
                    data: 指数策略低位ByDay.filter((item) => {
                        return item[3].includes("★")
                    }).map((item) => {
                        return [item[0], item[1].length, item[1]]
                    }).addStartEnd()
                },
                {
                    name: '大盘策略',
                    type: 'scatter',
                    xAxisIndex: 3,
                    yAxisIndex: 6,
                    symbol: "pin",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#003900"
                        }
                    },
                    symbolSize: function (val) {
                        return 6
                    },
                    zlevel: 2,
                    data: 指数策略低位ByDay.filter((item) => {
                        return !item[3].includes("★")
                    }).map((item) => {
                        return [item[0], item[1].length, item[1]]
                    }).addStartEnd()
                },


                {//基金策略
                    name: '基金策略',
                    type: 'scatter',
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    symbol: 'pin',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "black"
                        }
                    },
                    symbolSize: function (val) {
                        return 6
                    },
                    zlevel: 1,
                    data: 基金策略低位ByDay.filter((item) => {
                        return !item[3].includes("★")
                    }).map((item) => {
                        return [item[0], 43.5]
                    }).addStartEnd()
                },
                {
                    name: '基金策略',
                    type: 'scatter',
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    symbol: 'path://M 200 200 l-40 100 100 -80 -120 0 100 80 -40 -120 -40 120z',
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "black"
                        }
                    },
                    symbolSize: function (val) {
                        return 8
                    },
                    zlevel: 1,
                    data: 基金策略低位ByDay.filter((item) => {
                        return item[3].includes("★")
                    }).map((item) => {
                        return [item[0], 40.5]
                    }).addStartEnd()
                },



                {//指数沪深300D
                    name: "沪深300",
                    type: "line",
                    lineStyle: {
                        width: 0,
                    },
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                color: "#a3d4ff" // 87c5cf  a3d4ff
                            },
                        },
                        emphasis: {
                            areaStyle: {
                                color: "#a3d4ff",
                            },
                        },
                    },
                    showSymbol: false,
                    zlevel: 0,
                    xAxisIndex: 5,
                    yAxisIndex: 10,
                    data: 沪深300.map((item) => {
                        let tmp = []
                        tmp[0] = item.date
                        tmp[1] = item.close ? item.close : ""
                        return tmp
                    }).addStartEnd(),
                },
                {//指数上证D
                    name: "上证",
                    type: "line",
                    lineStyle: {
                        width: 0,
                    },
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                color: "#a3d4ff"//87c5cf  a3d4ff   57aacb
                            },
                        },
                        emphasis: {
                            areaStyle: {
                                color: "#a3d4ff",
                            },
                        },
                    },
                    showSymbol: false,
                    zlevel: 0,
                    xAxisIndex: 5,
                    yAxisIndex: 10,
                    data: 上证.map((item) => {
                        let tmp = []
                        tmp[0] = item.date
                        tmp[1] = item.close ? item.close : ""
                        return tmp
                    }).addStartEnd(),
                },


                {//股同比
                    name: "300同比",
                    type: "line",
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.3,
                    },
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.45, //大 下
                                    color: "red",
                                },
                                {
                                    offset: 0.6,
                                    color: "orange",
                                },

                                {
                                    offset: 0.8, //小 上
                                    color: "green",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "green",
                            },
                            label: {
                                formatter: "-20低估",
                                color: "green",
                                fontSize: "10",
                                position: "start",
                            },
                            yAxis: -20, // 标线值
                            x: "6.5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "red",
                            },
                            label: {
                                formatter: "30高估",
                                color: "red",
                                fontSize: "10",
                                position: "start",
                            },
                            yAxis: 30, // 标线值
                            x: "6.5%",
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "gray",
                                //type: "solid" // 实线，不写默认虚线
                            },
                            label: {
                                formatter: "30高估",
                                color: "red",
                                fontSize: "0",
                                position: "start",
                            },
                            yAxis: 0, // 标线值
                        },
                        ],
                    },
                    data: 沪深300同比.filter(item => {
                        return parseFloat(item[0].substring(0, 4)) >= 2008
                    }).addStartEnd()
                },

                {//pmi
                    name: 'pmi',
                    type: 'line',
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 0.7,
                        color: "#ff61ca", //"black" //

                    },

                    markLine: {
                        symbol: ["none", "none"],
                        data: [

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "上穿10,15",
                                    color: "#ff535c",
                                    fontSize: 8,
                                    position: "insideStartTop",
                                },
                                yAxis: 15, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "",
                                    color: "#ff535c",
                                    fontSize: 8,
                                    position: "insideStartTop",
                                },
                                yAxis: 10, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "",
                                    color: "#0081B6",
                                    fontSize: 8,
                                    position: "insideStartBottom",
                                },
                                yAxis: -7, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "下穿-7,-10",
                                    color: "#0081B6",
                                    fontSize: 8,
                                    position: "insideStartBottom",
                                },
                                yAxis: -10, // 标线值
                            }
                        ],
                    },
                    data: cn_pmi_平均.map(v => {
                        v[1] = parseFloat(v[1]) * 10
                        return v
                    }).addStartEnd(),
                },
                {
                    name: "汽车与出口",
                    type: "line",
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "black" //"#fd5f21", #fd9950
                    },
                    data: 零售汽车$出口.addStartEnd()
                },
                {
                    name: "房地产",
                    type: "line",
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.3,
                        color: "#E21D62" //"#ff8c00"
                    },
                    data: 商品房销售.addStartEnd()
                },
                {
                    name: "MM制造业",
                    type: "line",
                    xAxisIndex: 6,
                    yAxisIndex: 12,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "#565048",
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [
                            {
                                lineStyle: {
                                    width: 0.5,
                                    type: "solid",
                                    color: "black",
                                },

                                yAxis: 0, // 标线值
                            }
                        ]
                    },

                    data: MM制造业指标.map((item) => {
                        item[1] = item[1] * 10
                        return item
                    }).addStartEnd()
                },




                {//信贷
                    name: "信贷脉冲_宏择MA3",
                    type: "line",
                    xAxisIndex: 7,
                    yAxisIndex: 14,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.2,
                        type: 'dotted',
                        color: "black" //"#ff5c5c",

                    },
                    data: 信贷脉冲_宏择.addStartEnd(),
                },
                {
                    name: '信贷脉冲',
                    type: 'line',
                    xAxisIndex: 7,
                    yAxisIndex: 14,
                    smooth: true,
                    showSymbol: false,
                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.7, //小上 大下
                                "color": "green"
                            },
                            {
                                "offset": 0.5,
                                "color": "orange"
                            },

                            {
                                "offset": 0.3,
                                "color": "red"
                            }

                            ],
                            "globalCoord": false
                        }

                    },
                    lineStyle: {
                        width: 1.5,

                    },
                    data: 信贷脉冲.addStartEnd()
                },
                {
                    name: '信贷脉冲_MA4',
                    type: 'line',
                    xAxisIndex: 7,
                    yAxisIndex: 14,
                    smooth: true,
                    showSymbol: false,
                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.7,
                                "color": "green"
                            },
                            {
                                "offset": 0.5,
                                "color": "orange"
                            },

                            {
                                "offset": 0.3,
                                "color": "red"
                            }

                            ],
                            "globalCoord": false
                        }

                    },
                    lineStyle: {
                        width: 1.2,
                        type: 'dotted',

                    },
                    data: 信贷脉冲_MA.addStartEnd()
                },

                {//M1_2 
                    name: "M1_M2",
                    type: "line",
                    xAxisIndex: 7,
                    yAxisIndex: 15,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "black", //"#ff4900",

                    },
                    data: M1_M2.addStartEnd(),
                },
                {
                    name: "M1_M2_MA",
                    type: "line",
                    xAxisIndex: 7,
                    yAxisIndex: 15,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.2,
                        type: 'dotted',
                        color: "black" //"#ff5c5c",

                    },
                    data: M1_M2_MA.addStartEnd(),
                },

                {//us-cn-M
                    name: '金融脉动增速us',
                    type: 'line',
                    xAxisIndex: 7,
                    yAxisIndex: 15,
                    showSymbol: false,
                    //smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "#565048",
                    },
                    data: 金融脉动增速.map((item) => {
                        item[1] = Number(item[1]) * -10
                        return item
                    }).addStartEnd()
                },
                {
                    name: "中美汇",
                    type: "line",
                    xAxisIndex: 7,
                    yAxisIndex: 15,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 0.8,
                        color: "gray"
                    },
                    data: 中美汇率Day同比.addStartEnd()
                },

            ]
        };

        if (option && typeof option === "object") {
            myChart.setOption(option);
        }
        window.addEventListener("resize", myChart.resize);

        myChart.on('legendselectchanged', function (params) {

            if (params.name === "中位PE" && params.selected["中位PE"] === true) {
                option.yAxis[4].max = 7.5
                option.yAxis[4].min = 0.5
                option.yAxis[4].inverse = true
                option.yAxis[4].interval = 1.5

                params.selected["股债差"] = false
                option.legend.selected = params.selected
                myChart.setOption(option)
            }

            if (params.name === "股债差" && params.selected["股债差"] === true) {
                option.yAxis[4].max = 9
                option.yAxis[4].min = 0
                option.yAxis[4].inverse = true
                option.yAxis[4].interval = 3

                params.selected.中位PE = false
                option.legend.selected = params.selected
                myChart.setOption(option)
            }

        })

        setTimeout(() => {

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "ppi基数"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "上证"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "区间策略"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "大盘策略"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "基金策略"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "汽车与出口"
            });

            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "房地产"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "中位PE"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "恒指美债差"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "美债"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "MM制造业"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "M1_M2"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "M1_M2_MA"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "信贷脉冲_宏择MA3"
            })
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "中美汇"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "美元指"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "金融脉动增速us"
            });
            myChart.dispatchAction({
                type: 'legendToggleSelect',
                name: "300同比"
            });
        }, "1")


        window.onload = () => {
            window.onresize = function (e) {
                //console.log("window.innerHeight",window.innerHeight) 
                if (window.innerHeight >= 767) {  //880
                    option.grid = grid全屏
                    myChart.setOption(option)
                    myChart.dispatchAction({
                        type: 'legendSelect',
                        name: "300同比"
                    });

                } else if (window.innerHeight < 767) {
                    option.grid = grid默认
                    myChart.setOption(option)
                    myChart.dispatchAction({
                        type: 'legendUnSelect',
                        name: "300同比"
                    });
                }
            }//onresize
        }
    </script>
</body>

</html>